<div>
    <div class="card-body">
        <ul role="tablist" class="nav nav-tabs col-md-12">
            <li role="presentation" class="nav-item show active col-md-6">
                <a class="nav-link" id="info-tab" href="javascript:;" data-href="agency" data-toggle="tab">管理小组</a>
            </li>
            <li class="nav-item col-md-6">
                <a class="nav-link" id="account-tab" href="javascript:;" data-href="company" data-toggle="tab">主站下发资讯</a>
            </li>
        </ul>
        <div class="tab-content">
            <div id="agency" class="tab-pane fade show active" role="tabpanel" aria-labelledby="info-tab">
                <div class="col-md-12 row" style="
            margin-left: 6px;margin-bottom: 10px">
                    <div class="parentsitelist"></div>
                    <div class="endchild" style="margin-left: 5px"></div>
                </div>
                <div class="col-md-12">
                    <div class="card horizontal-form">
                        <div class="card-body">
                            <div class="row col-md-12">
                                <div class="col-md-3 col-sm-6 row" style="margin-left: 10px">
                                    <label class="col-md-6 control-label">审核状态</label>
                                    <div class="col-md-6 rylist">
                                        <div class="auditStatus"></div>
                                    </div>
                                </div>
                                <div class="col-md-4 col-sm-4 row">
                                    <div class="col-md-1"></div>
                                    <button style="margin-top: 5px;margin-left:23%" class="btn btn-e search">搜索</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-12">
                    <div class="padding-l-10 f-s-17 bod  box-s bod-r-8 padding-t-10">
                        <button class="btn btn-e" onclick="saveStudygroup()">小组新增</button>
                        <button class="btn btn-e" onclick="delBatch(this)">批量删除</button>
                    </div>
                </div>
                <div class="container-fluid padding-t-20">
                    <div class="row">
                        <div class="col-md-12 ">
                            <table class="table table-bordered table-hover" id="tablecz">
                                <thead>
                                <tr>
                                    <th><input class="fuxk" name="allcheck" type="checkbox" value="" id="allcheck"
                                               onclick="selectall(this)"/></th>
                                    <th class="text-center cuti">小组名称</th>
                                    <th class="text-center cuti">创建时间</th>
                                    <th class="text-center cuti">创建人</th>
                                    <th class="text-center cuti">成员数</th>
                                    <th class="text-center cuti">才艺数</th>
                                    <th class="text-center cuti">经验数</th>
                                    <th class="text-center cuti">状态</th>
                                    <th class="text-center cuti">操作</th>
                                </tr>
                                </thead>
                                <tbody id="queryPage"></tbody>

                            </table>
                            <div class="fenye">
                                <div class="pagination pagination0"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div id="company" class="tab-pane fade show" role="tabpanel" aria-labelledby="account-tab">
                <div class="col-md-12">
                    <div class="card horizontal-form">
                        <div class="card-body">
                            <div class="row col-md-12">
                                <label class="col-md-2 control-label"
                                       style="text-align: center">&nbsp;&nbsp;小组名称</label>
                                <div class="col-md-3 rylist">
                                    <input type="text" class="form-control sgpName">
                                </div>
                                <div class="col-md-2 col-sm-6">
                                    <div class="col-md-1"> </divc>
                                        <button style="margin-top: 5px" class="btn btn-e sendSearch">搜索</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="container-fluid padding-t-20">
                        <div class="row">
                            <div class="col-md-12 ">
                                <table class="table table-bordered table-hover" id="tablecztwo">
                                    <thead>
                                    <tr>
                                        <th class="text-center cuti">小组名称</th>
                                        <th class="text-center cuti">创建时间</th>
                                        <th class="text-center cuti">创建人</th>
                                        <th class="text-center cuti">成员数</th>
                                        <th class="text-center cuti">才艺</th>
                                        <th class="text-center cuti">经验数</th>
                                        <th class="text-center cuti">状态</th>
                                    </tr>
                                    </thead>
                                    <tbody id="queryPagetwo"></tbody>
                                </table>
                                <div class="fenye">
                                    <div class="pagination pagination1"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script type="text/html" id="queryPage_t">
    {{each data}}
    <tr class="{{$value.sgpId}}">
        <td><input class="fuxk" name="choose" type="checkbox" value="{{$value.sgpId}}"/>
        </td>
        <td class="text-center"> {{$value.sgpName}}</td>
        <td class="text-center"> {{$value.createDate}}</td>
        <td class="text-center">
            {{$value.createByName}}
        </td>
        <td class="text-center">
            {{$value.sgpUserNum}}
        </td>
        <td class="text-center">
            {{$value.talentNum}}
        </td>
        <td class="text-center">
            {{$value.experienceNum}}
        </td>
        <td class="text-center" data-status="{{$value.sgpStatus}}">
            {{if $value.sgpStatus==0}}未提交
            {{else if $value.sgpStatus==1}}审核中
            {{else if $value.sgpStatus==2}}审核通过
            {{else if $value.sgpStatus==3}}审核失败
            {{/if}}
        </td>
        <td class="text-center" data-id="{{$value.sgpId}} ">
            <a href="javascript:void(0);" data-status="{{$value.sgpStatus }}" data-id="{{$value.sgpId}}"
               onclick="audit(this)">
                {{if $value.sgpStatus=="0"}}提交审核
                {{else if $value.sgpStatus=="1"}}审核
                {{/if}}
            </a>
            <a href="javascript:void(0);" data-type="now" data-id="{{$value.sgpId}}"
               onclick="view(this)">预览</a>
            <a href="javascript:void(0);" data-type="now" data-id="{{$value.sgpId}}"
               onclick="deleteById(this)">删除</a>
        </td>

    </tr>
    {{/each}}
</script>

<script type="text/html" id="queryPagetwo_t">
    {{each data}}
    <tr class="{{$value.sgpId}}">
        <td><input class="fuxk" name="choose" type="checkbox" value="{{$value.sgpId}}"/>
        </td>
        <!--改第一个tab表格抬头对应数据开始-->
        <td class="text-center"> {{$value.sgpName}}</td>
        <td class="text-center"> {{$value.createDate}}</td>
        <td class="text-center">
            {{$value.createBy}}
        </td>
        <td class="text-center">
            {{$value.sgpUserNum}}
        </td>
        <td class="text-center">
            {{$value.talentNum}}
        </td>
        <td class="text-center">
            {{$value.experienceNum}}
        </td>
        <td class="text-center" data-status="{{$value.sgpStatus}}">
            {{if $value.sgpStatus==0}}提交
            {{else if $value.sgpStatus==1}}审核中
            {{else if $value.sgpStatus==2}}审核通过
            {{else if $value.sgpStatus==3}}审核失败
            {{/if}}
        </td>

    </tr>
    {{/each}}
</script>


<script>
    (function (window, $) {
        $('a[data-toggle="tab"]').on('shown.bs.tab', function (e) {
            var choldnode = $(".tab-content").children();
            for (let i = 0; i < choldnode.length; i++) {
                choldnode[i].style.display = "none"
            }
            $("#" + this.dataset.href + "")[0].style.display = "block";
        });
        utils_admin.delpostdata("sgpId");
        var pagepostdata = utils_admin.clone(apidata.postdata);
        //列表1  修改查询接口-apidata.news.queryPage
        let pagedataone = utils_admin.setajax('POST', pagepostdata, apidata.studygroup.studygrouplist);
        utils_admin.queryPage("queryPage", "queryPage_t", pagedataone);
        //分页1
        new pagination({
            pagination: $('.pagination0'),//分页挂载的样式名称
            maxPage: 5, //最大页码数,支持奇数，左右对称
            startPage: 1,    //默认第一页
            currentPage: 1,          //当前页码
            totalPageCount: (pagedataone.totalCount / pagedataone.pageSize) - (pagedataone.totalCount / pagedataone.pageSize) % 1 + 1,  //总页数
            callback: function (pageNum) {
                pagepostdata.payload.page = "" + pageNum + "";
                //修改查询接口-apidata.news.queryPage
                utils_admin.queryPage("queryPage", "queryPage_t", utils_admin.setajax('POST', pagepostdata, apidata.studygroup.studygrouplist));
            }
        });

        let pagedatatwo = utils_admin.setajax('POST', pagepostdata, apidata.studygroup.studygrouplowerPage);
        utils_admin.queryPage("queryPagetwo", "queryPagetwo_t", pagedatatwo);
        //分页2
        new pagination({
            pagination: $('.pagination1'),//分页挂载的样式名称
            maxPage: 5, //最大页码数,支持奇数，左右对称
            startPage: 1,    //默认第一页
            currentPage: 1,          //当前页码
            totalPageCount: (pagedataone.totalCount / pagedataone.pageSize) - (pagedataone.totalCount / pagedataone.pageSize) % 1 + 1,  //总页数
            callback: function (pageNum) {
                pagepostdata.payload.page = "" + pageNum + "";
                //修改查询接口-apidata.news.queryPage
                utils_admin.queryPage("queryPagetwo", "queryPagetwo_t", utils_admin.setajax('POST', pagepostdata, apidata.studygroup.studygrouplowerPage));
            }
        });

        //站点,平台初始化
        window.utils_admin.loadhtml($(".parentsitelist"), '/dropdown.html', {
            "header": "所有平台",
            "id": null,
            "body": window.parentSiteList,
            "width": 120,
            "name": "parentsitelist",
        });
        window.utils_admin.loadhtml($(".endchild"), '/dropdown.html', {
            "header": "先选择平台",
            "id": null,
            "body": null,
            "width": 120,
            "name": "endchild",
        });
        //换站点
        $(".parentsitelist").click(function (a) {
            let id = '', endchild = [];
            if (a.target.nodeName.toLowerCase() == "li") {
                id = a.target.getAttribute("id");
            }
            else {
                id = window.parentSiteList[0].id
            }
            window.childSiteList.forEach((a) => {
                a.forEach((e, index) => {
                    if (e.ptId == id) {
                        endchild.push(e)
                        endchild[index].text = endchild[index].siteName;
                        endchild[index].id = endchild[index].siteId;
                    }
                })
            });
            pagepostdata.payload.siteId = endchild[0].id;

            window.utils_admin.loadhtml($(".endchild"), '/dropdown.html', {
                "header": endchild[0].text,
                "id": endchild[0].id,
                "body": endchild,
                "width": 120,
                "name": "endchild",
            });
        });
        $(".endchild").click(function (a) {
            pagepostdata.payload.siteId = utils_admin.downid(a, "endchild");
        });
        window.utils_admin.loadhtml($(".auditStatus"), '/dropdown.html', {
            "header": "请选择",
            "id": null,
            "body": [
                {
                    "text": "未审核",
                    "id": "0"
                }, {
                    "text": "审核中",
                    "id": "1"
                }, {
                    "text": "审核成功",
                    "id": "2"
                }, {
                    "text": "审核失败",
                    "id": "3"
                }
            ],
            "width": 120,
            "name": "auditStatus",
        });

        //全选
        function selectall(thit) {
            let checkboxs = document.getElementsByName("choose");
            if (thit.checked) {
                for (let i = 0; i < checkboxs.length; i++) {
                    let e = checkboxs[i];
                    e.checked = true;
                }
            } else {
                for (let i = 0; i < checkboxs.length; i++) {
                    let e = checkboxs[i];
                    e.checked = false;
                }
            }
        }

        //删除
        function deleteById(e) {
            pagepostdata.payload.sgpId = e.dataset.id;
            $("#toolTipbox").toggle("hidden");
        }

        //批量删除
        function delBatch(e) {
            pagepostdata.payload.sgpId = utils_admin.choosevalue("tablecz");
            $("#toolTipbox").toggle("hidden");
        }


        $("#toolTipbox>.white_content").off('click').on('click', function (a) {
            if (a.target.nodeName.toLowerCase() == "button") {
                $("#toolTipbox").toggle("hidden")
            }
            if (a.target.dataset.id) {
                utils_admin.setajax('POST', pagepostdata, apidata.studygroup.studygroupDelete);
                utils_admin.queryPage("queryPage", "queryPage_t", utils_admin.setajax('POST', pagepostdata, apidata.studygroup.studygrouplist));
            }
            a.stopPropagation();
        });


        //小组审核
        function audit(e) {
            var id = $(e).attr("data-id");
            pagepostdata.payload.sgpId = id;
            var status = $(e).attr("data-status");
            //假如状态为1 时跳转审核页面 否则调用提交接口
            if (status == "1") {
                // studygroupaudit
                utils_admin.redact("studygroupaudit", "sgpId", e)
            } else {
                pagepostdata.payload.sgpStatus = "1";
                utils_admin.setajax('POST', pagepostdata, apidata.studygroup.studygroupSumbit);

                utils_admin.delpostdata("sgpId,sgpStatus");
                utils_admin.queryPage("queryPage", "queryPage_t", utils_admin.setajax('POST', pagepostdata, apidata.studygroup.studygrouplist));
            }

        }

        //小组新增
        function saveStudygroup() {
            //跳转到新增页面
            window.location.href = "/admin/views/index.html#/studygroupadd";
        }

        //预览
        function view(e) {
            utils_admin.redact("studygroupadd", "sgpId", e)
        }

        //主站下发列表查询
        $(".sendSearch").click(function () {
            var startDate = $("#startDate").val();
            var endDate = $("#endDate").val();
            var sgpName = $(".sgpName").val();
            pagepostdata.payload.startDate = startDate;
        });

        //主站下发搜索
        $(".sendSearch").click(function () {
            var sgpName = $(".sgpName").val();
            pagepostdata.payload.sgpName = sgpName;
            var startDate = $("#startDate").val();
            pagepostdata.payload.startDate = startDate;
            var endDate = $("#endDate").val();
            pagepostdata.payload.endDate = endDate;
            utils_admin.queryPage("queryPage", "queryPage_t", utils_admin.setajax('POST', pagepostdata, apidata.studygroup.studygrouplowerPage));

        });
        window.delBatch = delBatch;
        window.selectall = selectall;
        window.deleteById = deleteById;
        window.audit = audit;
        window.saveStudygroup = saveStudygroup;
        window.view = view;
    })(window, window.$);
</script>
