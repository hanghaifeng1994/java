
<!--子站使用-->
<div>
    <div class="card-body">
        <div class="col-md-12">
            <div class="card horizontal-form">
                <div class="card-body">
                    <div class="row col-md-12">
                        <div class="col-md-9 col-sm-12 row">
                            <label class="col-md-2 control-label">所属平台</label>
                            <div class="col-md-4 col-sm-4 rylist">
                                <div class="dropdowns"></div>
                            </div>
                            <div class="col-md-4 col-sm-4 rylist">
                                <div class="dropdowns"></div>
                            </div>
                        </div>
                    </div>
                    <div class="row col-md-12">
                        <div class="col-md-4 col-sm-6">
                            <div class="row rylist">
                                <label class="col-md-4 control-label">账号名称</label>
                                <div class="col-md-7">
                                    <input type="text" class="form-control">
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3 col-sm-6">
                            <div class="row rylist">
                                <label class="col-md-3 control-label">姓名</label>
                                <div class="col-md-9">
                                    <input type="text" class="form-control">
                                </div>
                            </div>
                        </div>
                        <div class="col-md-5 col-sm-6 row">
                            <label class="col-md-3 control-label" >账号状态</label>
                            <div class="dropdowns rylist"></div>
                        </div>
                    </div>
                    <div class="row col-md-12">
                        <div class="col-md-4 col-sm-6">
                            <div class="row rylist">
                                <label class="col-md-4 control-label">身份证号码</label>
                                <div class="col-md-7">
                                    <input type="text" class="form-control">
                                </div>
                            </div>
                        </div>

                        <div class="col-md-4 col-sm-6 row">
                            <label class="col-md-4 control-label" style="margin-left: -20px">实名状态</label>
                            <div class="dropdowns rylist"></div>
                        </div>
                        <div class="col-md-3 col-sm-6">
                            <button  style="margin-top: 10px" class="btn btn-wd btn-e">搜索</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-12">
            <div class="padding-l-10 f-s-17 bod  box-s bod-r-8 padding-t-10">
                <button class="btn btn-f btn-wd" onclick="deleteclass()">批量删除</button>
            </div>
        </div>
        <div class="container-fluid padding-t-20">
            <div class="row">
                <div class="col-md-12 ">
                    <table class="table table-bordered table-hover" id="tablecz">
                        <thead>
                        <tr>
                            <th><input class="fuxk" name="allcheck" type="checkbox" value="" id="allcheck"
                                       onclick="selectall()"/></th>
                            <th class="text-center cuti">账号名称</th>
                            <th class="text-center cuti">姓名</th>
                            <th class="text-center cuti">单位</th>
                            <th class="text-center cuti">身份证</th>
                            <th class="text-center cuti">实名认证</th>
                            <th class="text-center cuti">状态</th>
                            <th class="text-center cuti">操作</th>
                        </tr>
                        </thead>
                        <tbody id="queryPage"></tbody>


                    </table>
                    <div class="fenye">
                        <div class="pagination pagination1"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script type="text/html" id="queryPage_t">
    {{each data}}
    <tr class="{{$value.articleId}}">
        <td><input class="fuxk" name="choose" type="checkbox" value="{{$value.articleId}}"/>
        </td>
        <td class="text-center"> {{$value.ptName}}</td>
        <td class="text-center"> {{$value.ptName}}</td>
        <td class="text-center"> {{$value.ptName}}</td>
        <td class="text-center">{{$value.ptName}}</td>
        <td class="text-center">
                                       <span data-pubStatus="{{$value.articleId}}">
                                        {{if $value.posid=="1"}}是
                                        {{else}}否
                                        {{/if}}
                                       </span>
            /
            <span data-weight="{{$value.articleId}}">
                                         {{if $value.weight=="999"}}是
                                        {{else}}否
                                        {{/if}}
                                        </span>
        </td>
        <td class="text-center" data-status="{{$value.status}}">
            {{if $value.status==0}}未提交
            {{else if $value.status==1}}审核中
            {{else if $value.status==2}}审核通过
            {{else if $value.status==2}}审核失败
            {{/if}}
        </td>
        <td class="text-center caozuo">
            <a href="javascript:void(0);" data-id="{{$value.articleId}}"
               onclick="pubStatus(this)">
                编辑</a>
            <a href="javascript:void(0);" data-id="{{$value.articleId}}"
               onclick="posid(this)">
                禁用
            </a>

            <a href="javascript:void(0);" data-id="{{$value.articleId}}"
               onclick="onedel(this)">删除</a>
        </td>
    </tr>
    {{/each}}
</script>

<script>

    (function (window, $) {
        window.utils_admin.calendar($('.datepicker'));
        //站点,平台初始化
        let chaildsitlist = [], parentsitlist = [];
        let siteslist = utils_admin.setajax('POST', apidata.postdata, apidata.base.staffPtSitesList);
        siteslist.data.forEach((a, index) => {
            parentsitlist.push(a);
            chaildsitlist.push(a.siteList);
            parentsitlist[index].text = parentsitlist[index].ptCode
            parentsitlist[index].id = parentsitlist[index].ptId;
        });
        window.utils_admin.loadhtml($(".parentsitlist"), '/dropdown.html', {
            "heard": parentsitlist[0].text,
            "id": parentsitlist[0].id,
            "body": parentsitlist,
            "width": 120,
            "name": "parentsitlist",
        });
        window.utils_admin.loadhtml($(".endchild"), '/dropdown.html', {
            "heard": "先选择平台",
            "id": null,
            "body": null,
            "width": 120,
            "name": "endchild",
        });
        //换站点
        $(".parentsitlist").click(function (a) {
            let id = '', endchild = [];
            if (a.target.nodeName.toLowerCase() == "li") {
                id = a.target.getAttribute("id")
            } else {
                id = parentsitlist[0].id
            }
            chaildsitlist.forEach((a) => {
                a.forEach((e, index) => {
                    if (e.ptId == id) {
                        endchild.push(e)
                        endchild[index].text = endchild[index].siteName;
                        endchild[index].id = endchild[index].ptId
                    }
                })
            });
            window.utils_admin.loadhtml($(".endchild"), '/dropdown.html', {
                "heard": endchild[0].text,
                "id": endchild[0].id,
                "body": endchild,
                "width": 120,
                "name": "endchild",
            });
        });
        //栏目一初始化
        let newscategoryone = utils_admin.setajax('POST', apidata.postdata, apidata.news.newsCategoryqueryPage);
        let newscategoryonearr = [];
        newscategoryone.data.forEach((a) => {
            a.text = a.catName
            a.id = a.catId
            newscategoryonearr.push(a)
        });
        window.utils_admin.loadhtml($(".newscategoryone"), '/dropdown.html', {
            "heard": "栏目一",
            "id": null,
            "body": newscategoryonearr,
            "width": 135,
            "name": "newscategoryonearr",
        });
        //换栏目
        $(".newscategoryone").click(function (a) {
            let id = '', endchild = [];
            if (a.target.nodeName.toLowerCase() == "li") {
                id = a.target.getAttribute("id")
            } else {
                id = parentsitlist[0].id
            }
            apidata.postdata.payload.parentId = id;
            let newscategorytwo = utils_admin.setajax('POST', apidata.postdata, apidata.news.newsCategoryqueryPage);
            console.log(newscategorytwo)
            if(newscategorytwo.data){
                newscategorytwo.data.forEach((a) => {
                    endchild.push(a)
                    endchild[index].text = endchild[index].siteName;
                    endchild[index].id = endchild[index].ptId
                })
            }else {
                endchild[0].text="空"
            }
            window.utils_admin.loadhtml($(".newscategorytwo"), '/dropdown.html', {
                "heard": endchild[0].text,
                "id": endchild[0].id,
                "body": endchild,
                "width": 120,
                "name": "newscategorytwo",
            });
        })
        window.utils_admin.loadhtml($(".newscategorytwo"), '/dropdown.html', {
            "heard": "栏目二",
            "id": null,
            "body": null,
            "width": 120,
            "name": "newscategorytwo",
        });
        window.utils_admin.loadhtml($(".statusstate"), '/dropdown.html', {
            "heard": "审核",
            "id": null,
            "body": [
                {
                    "text":"未提交",
                    "id":"1"
                },
                {
                    "text":"提交",
                    "id":"2"
                },
            ],
            "width": 120,
            "name": "statusstate",
        });
        window.utils_admin.loadhtml($(".stickstate"), '/dropdown.html', {
            "heard": "置顶",
            "id": null,
            "body": [
                {
                    "text":"置顶",
                    "id":"1"
                },
                {
                    "text":"未置顶",
                    "id":"2"
                },
            ],
            "width": 120,
            "name": "stickstate",
        });
        //列表1
        let pagedataone = utils_admin.setajax('POST', apidata.postdata, apidata.base.queryList);
        utils_admin.queryPage("queryPage", "queryPage_t", pagedataone);
        //分页1
        new pagination({
            pagination: $('.pagination0'),
            maxPage: 5, //最大页码数,支持奇数，左右对称
            startPage: 1,    //默认第一页
            currentPage: 1,          //当前页码
            totalPageCount: pagedataone.pageSize,        //总页数
            callback: function (pageNum) {
                apidata.postdata.payload.page = "" + pageNum + "";
                utils_admin.queryPage("queryPage", "queryPage_t", utils_admin.setajax('POST', apidata.postdata, apidata.base.queryList));
            }
        });

    })(window, window.$);



    window.utils_admin.loadhtml($(".dropdowns"), '/dropdown.html', {
        "heard": "平台管理员",
        "body": [
            {
                "text": "1"
            },
            {
                "text": "2"
            },
            {
                "text": "3"
            }
        ],
        "width": 120
    })

    function selectall() {
        var checkboxs = document.getElementsByName("choose");
        for (var i = 0; i < checkboxs.length; i++) {
            var e = checkboxs[i];
            e.checked = !e.checked;
        }
    }

    //加载弹窗组件
    function popups(data) {
        $("#popups").load('./template/popups.html', function (a) {
            $("#popups").html(window.template.render(a, data));
            ballblack();
        })
    }

    //单独删除
    function onedel(e) {
        console.log(e.id);
        let data = {
            "tempid": 'tableclassone',
            "checkdata": '',
            "body": {
                "head": "提示",
                "text": "是否确认删除",
                "yesbt": "确认",
                "nobt": "取消"
            }
        };
        data.checkdata = e.id
        popups(data)
    }

    function tableclassone(e) {
        $("#" + e).remove();
        ballblack();
    }

    //批量删除
    function deleteclass() {
        let checkboxs = $("input[name=choose]");
        let data = {
            "tempid": 'balldeleteclass',
            "checkdata": [],
            "body": {
                "head": "提示",
                "text": "是否确认删除选中的内容",
                "yesbt": "确认",
                "nobt": "取消"
            }
        };
        for (let i = 0; i < checkboxs.length; i++) {
            if (checkboxs[i].checked) {
                data.checkdata.push(checkboxs[i].value);
            }
        }
        if (data.checkdata.length) {
            popups(data);
        }
    }

    function balldeleteclass(e) {
        for (let i = 0; i < e.length; i++) {
            $("#" + e[i]).remove();
            ballblack();
        }
    }


</script>