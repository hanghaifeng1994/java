<div class="col-md-12">
    <div class="horizontal-form">
        <div class="card-body">
            <div class="form-group col-xl-12 padding-t-10">
                <div class="row">
                    <label class="col-md-2 control-label brokeragetime">资源名称</label>
                    <div class="col-md-4">
                        <input type="text" placeholder="" class="form-control">
                    </div>
                </div>
            </div>
            <div class="form-group col-xl-12 padding-t-10">
                <div class="row">
                    <label class="col-md-2 control-label brokeragetime">上传资源</label>
                    <div class="col-md-10">
                            <span id="uploadImg">
                                <input type="file" id="file" size="1">
                                <a href="javascript:;">上传文件</a>
                            </span>
                        <p id="em">未上传</p>
                    </div>
                </div>
            </div>
            <div class="form-group col-xl-12 padding-t-10">
                <div class="row">
                    <label class="col-md-2 control-label brokeragetime">清晰度</label>
                    <div class="col-md-4">
                        <div class="definition"></div>
                    </div>
                </div>
            </div>
            <div class="form-group col-xl-12 padding-t-10">
                <div class="row">
                    <label class="col-md-2 control-label brokeragetime">来源</label>
                    <div class="col-md-4">
                        <input type="text" placeholder="" class="form-control">
                    </div>
                </div>
            </div>
            <div class="form-group col-xl-12 padding-t-10">
                <div class="row">
                    <label class="col-md-2 control-label brokeragetime">主讲</label>
                    <div class="col-md-4">
                        <input type="text" placeholder="" class="form-control">
                    </div>
                </div>
            </div>


            <div class="form-group col-xl-12 padding-t-10">
                <div class="row">
                    <label class="col-md-2 control-label brokeragetime">所属平台</label>
                    <div class="col-md-10 row rylist">
                        <div class="col-md-4">
                            <div class="parentsitelist"></div>
                        </div>
                        <div class="col-md-4">
                            <div class="endchild"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="form-group col-xl-12 padding-t-10">
                <div class="row">
                    <label class="col-md-2 control-label brokeragetime">是否启用</label>
                    <div class="col-md-10 row rylist">
                        <div class="dropdowns col-md-4"></div>
                    </div>
                </div>
            </div>
            <br/>
            <br/>
            <div class="form-group col-xl-12 padding-t-20">
                <div class="row">
                    <div class="col-md-2"></div>
                    <div class="col-md-8">
                        <button type="submit" class="btn btn-fill  btn-e col-md-2" onclick="savemessageg()">保存</button>
                        <button type="submit" class="btn btn-fill  btn-e col-md-2" onclick="publish()">保存并提交</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>


<script>
    (function (window) {
        var pagepostdata = apidata.postdata;
        window.utils_admin.loadhtml($(".definition"), '/dropdown.html', {
            "header": "高清",
            "id": "1",
            "width": 150,
            "name": "definition",
            "body": [
                {
                    "text": "高清",
                    "id": "0"
                },
                {
                    "id": "1",
                    "text": "标清"
                }
            ]
        });
        window.utils_admin.loadhtml($(".dropdowns"), '/dropdown.html', {
            "header": "是",
            "id": "1",
            "width": 150,
            "name": "dropdowns",
            "body": [
                {
                    "text": "是",
                    "id": "1"
                },
                {
                    "id": "0",
                    "text": "否"
                }
            ]
        });
        var childSiteList = [], parentSiteList = [];
        //取得管理员可管理站点列表即查询员工平台站点列表
        let siteslist = utils_admin.setajax('POST', apidata.postdata, apidata.base.staffPtSitesList);
        siteslist.data.forEach((a, index) => {
            parentSiteList.push(a);
            childSiteList.push(a.siteList);
            parentSiteList[index].text = parentSiteList[index].ptName
            parentSiteList[index].id = parentSiteList[index].ptId;
        });
        window.utils_admin.loadhtml($(".parentsitelist"), '/dropdown.html', {
            "header": "选择平台",
            "id": null,
            "body": parentSiteList,
            "width": 160,
            "name": "parentsitelist",
        });
        window.utils_admin.loadhtml($(".endchild"), '/dropdown.html', {
            "header": "先选择平台",
            "id": null,
            "body": null,
            "width": 170,
            "name": "endchild",
        });
        //换站点
        $(".parentsitelist").click(function (a) {
            let id = '', endchild = [];
            if (a.target.nodeName.toLowerCase() == "li") {
                id = a.target.getAttribute("id")
            } else {
                id = $(".parentsitelist")[0].id
            }
            childSiteList.forEach((a) => {
                a.forEach((e, index) => {
                    if (e.ptId == id) {
                        endchild.push(e);
                        endchild[index].text = endchild[index].siteName;
                        endchild[index].id = endchild[index].siteId;
                    }
                })
            });
            window.utils_admin.loadhtml($(".endchild"), '/dropdown.html', {
                "header": endchild[0].text,
                "id": endchild[0].id,
                "body": endchild,
                "width": 170,
                "name": "endchild",
            });
        });
        $(".endchild").click(function (a) {
            var id='';
            if (a.target.nodeName.toLowerCase() == "li") {
                id = a.target.getAttribute("id")
            } else {
                id = $(".endchild")[0].id
            }
            pagepostdata.payload.siteId = id;
        })
        //上传附件
        $('#file').on('change', function (e) {
            var setdataform = e.currentTarget.files[0],
                name = setdataform.name,
                type = (setdataform.name.substr(setdataform.name.lastIndexOf("."))).toLowerCase();
            if (type == ".WMV" || type == ".flv" || type == ".mp4" || type == ".avi" && setdataform.size / 1024 / 1024 < 450) {
                $('#em').text("正在上传中...");
                apidata.postdata.payload.fileIds = 0;
                var formData = new FormData();
                formData.append('imgFile', setdataform);
                $.ajax({
                    url: apidata.file.uploadVido,
                    type: 'POST',
                    data: formData,
                    cache: false,
                    contentType:false,
                    transferEncoding:"chunked",
                    processData:false,
                    success: function (e) {
                        if (e.success == "1") {
                            $('#em').text(e.data.fileName + " 上传成功");
                            pagepostdata.payload.fileIds = e.data.fileId;
                            pagepostdata.payload.fileIdNames = e.data.fileName;
                            pagepostdata.payload.fileType = e.data.fileType;
                            pagepostdata.payload.fileFormat = e.data.fileExt;
                            pagepostdata.payload.fileSize = e.data.fileSize;
                            pagepostdata.payload.fileTimeLen = e.data.timeLength;
                        } else {
                            $('#em').text("上传失败");
                        }
                    },
                    error: function (e) {
                        $('#em').text("上传失败");
                    },
                    beforeSend: function(xhr) {
                        xhr.setRequestHeader("maxSize", 450);
                    }
                })
            } else {
                alert("请选择flv,mp4,avi格式,并不能大于450m");
                return false;
            }
        });
        //保存
        function savemessageg() {
            let inputdata = $("input");
            if (inputdata[0].value == '') {
                alert("必填项")
            } else {
                pagepostdata.payload.resName = inputdata[0].value;
                pagepostdata.payload.copyfrom = inputdata[1].value;
                pagepostdata.payload.resAuthor = inputdata[2].value;
                if(apidata.postdata.payload.photo==0){
                    alert("文件或者图片正在上传")
                }else {
                    let setdata=utils_admin.setajax('POST', pagepostdata, apidata.resource.rsave);
                    pagepostdata.payload.articleId=setdata.data.status;
                }
            }
        }
        //发布
        function publish() {
            savemessageg();
            utils_admin.setajax('POST', pagepostdata, apidata.resource.rpublish);
            window.location.href="/admin/views/index.html#/resource"
        }
        window.savemessageg=savemessageg;
        window.pubStatus=publish
    })(window)
</script>