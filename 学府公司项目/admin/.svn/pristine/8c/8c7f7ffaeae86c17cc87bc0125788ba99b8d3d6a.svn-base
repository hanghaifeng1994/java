<div class="col-md-12">
    <div class="col-md-12 row" style="padding-top: 10px">
        <div class="col-md-6 col-xs-12 row ">
            <div class="col-md-12 col-xs-12">
                <button class="btn btn-e btn-wd" onclick="add()">新增章节</button>
                <button class="btn btn-e btn-wd" onclick="deleteclass(this)">批量删除</button>
            </div>
        </div>
    </div>
    <div class="treetable"></div>
</div>
<script>
    (function (window) {
        var pagepostdata = utils_admin.clone(apidata.postdata);
        pagepostdata.payload={};
        pagepostdata.payload.sectionId='0'
        console.log(pagepostdata)
        var pagedata = utils_admin.setajax('POST', pagepostdata, apidata.setting.setLinks).data;
        console.log(pagedata)
        pagedata.forEach((a, b) => {
            a.id = a.id;
            a.one = a.name;
            a.two = a.url;
            a.three = a.sort;
            a.four = a.status;
            if (a.childData) {
                a.child = false
            } else {
                a.child = true
            }
            a.menu = [
                {
                    "text": "编辑",
                    "method": "redactclass",
                },
                {
                    "text": "删除",
                    "method": "onedel",
                },
                {
                    "text": "禁用",
                    "method": "add",
                }
            ]
        });
        console.log(pagedata);
        window.utils_admin.loadhtml($('.treetable'), '/treeTable.html', {
            "datath": [
                {
                    "text": "链接名称"
                },
                {
                    "text": "链接地址"
                },
                {
                    "text": "排列顺序"
                },
                {
                    "text": "是否启用"
                },
                {
                    "text": "操作"
                }
            ],
            "tabledata": pagedata,
        });

        function selectallbelow(e) {
            console.log(e)
        }

        function beforeExpand(treeTable, id) {
            if ($('.' + id, treeTable).length) {
                return;
            }
            console.log(id)
            pagepostdata.payload.sectionId = id;
            let postdata = utils_admin.setajax('POST', pagepostdata, apidata.setting.setLinks).data;
            if (postdata) {
                let html = '';
                for (var i = 0; i < postdata.length; i++) {
                    postdata[i].childData ? postdata[i].childData = true : postdata[i].childData = false;
                    html += "<tr id=" + postdata[i].sectionId + " pId=" + postdata[i].parentId + " hasChild=" + postdata[i].childData + ">" +
                        "<td><input class='fuxk' name='choose' type='checkbox' value=" + id + "/></td>" +
                        "<td>" + postdata[i].name + "</td>" +
                        "<td>" + postdata[i].qpId + "</td>" +
                        "<td  class='text-center caozuo' style='color: #00bbff'>" +
                        "<a onclick='redactclass(this)' data-id=" + postdata[i].sectionId + ">编辑  </a>" +
                        "<a onclick='onedel(this)' data-id=" + postdata[i].sectionId + ">删除</a>" +
                        "</td></tr>";
                }
                treeTable.addChilds(html);
            }
        }

        ///删除
        function onedel(e) {
            var id = e.dataset.id;
            pagepostdata.payload.articleId = id;
            $("#popups").toggle("hidden");
        }


        //批量删除
        function deleteclass(a) {
            $("#popups").toggle("hidden");
            pagepostdata.payload.articleId = utils_admin.choosevalue("messagegerent");
        }
        $("#popups>.white_content").click(function (a) {
            if (a.target.nodeName.toLowerCase() == "button") {
                $("#popups").toggle("hidden")
            }
            if (a.target.dataset.id=='1') {
                utils_admin.setajax('POST', pagepostdata, apidata.news.delete);
                utils_admin.queryPage("messagegerent", "messagegerent_t", utils_admin.setajax('POST', pagepostdata, apidata.news.queryPage));
            }
        });

        //全选
        function selectall (thit) {
            let checkboxs = document.getElementsByName("choose");
            if (thit.checked) {
                for (let i = 0; i < checkboxs.length; i++) {
                    let e = checkboxs[i];
                    e.checked = true;
                }
            } else {
                for (let i = 0; i < checkboxs.length; i++) {
                    let e = checkboxs[i];
                    e.checked = false;
                }
            }
        }
        window.selectallbelow=selectallbelow;
        window.beforeExpand=beforeExpand;
        window.selectall=selectall;
        window.onedel =onedel ;
        window.deleteclass =deleteclass ;
    })(window)
</script>