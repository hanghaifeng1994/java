<div class="card-body">
    <ul role="tablist" class="nav nav-tabs col-md-12">
        <li role="presentation" class="nav-item show active col-md-6">
            <a class="nav-link" id="info-tab" href="javascript:;" data-href="agency" data-toggle="tab">管理资讯</a>
        </li>
        <li class="nav-item col-md-6">
            <a class="nav-link" id="account-tab" href="javascript:;" data-href="company" data-toggle="tab">主站下发资讯</a>
        </li>
    </ul>
    <div class="tab-content">
        <div id="agency" class="tab-pane fade show active" role="tabpanel" aria-labelledby="info-tab">
            <div class="col-md-12 row" style="margin-left: 1px;margin-bottom: 10px">
                <div class="parentsitelist"></div>
                <div class="endchild" style="margin-left: 5px"></div>
            </div>
            <div class="col-md-12">
                <div class="card horizontal-form">
                    <div class="card-body">
                        <div class="row col-md-12">
                            <div class="col-md-3 col-sm-8 row">
                                <label class="col-md-6 control-label">栏目</label>
                                <div class="col-md-6 rylist">
                                    <div class="newscategoryone"></div>
                                </div>
                            </div>
                            <div class="col-md-1"></div>
                            <div class="col-md-8 col-sm-8 row">
                                <ul class=" list-unstyled list-inline antime1 rylist row">
                                    <li class="fdong brokeragetime timecolor"
                                        style="width: 14% ;margin-left:20px;margin-right: 10px;">
                                        发布日期
                                    </li>
                                    <li class="" style="width: 35%">
                                        <input type="text" id="datetimepicker1" class="form-control datepicker"
                                               placeholder="选择日期"/>
                                    </li>

                                    <li class="fdong timecolor" style="width:8%;">到</li>
                                    <li class="" style="width: 35%">
                                        <input type="text" class="form-control datepicker" placeholder="选择日期"/>
                                    </li>
                                </ul>
                            </div>
                        </div>
                        <!--修改搜索条件开始-->
                        <div class="row col-md-12">
                            <div class="col-md-4 col-sm-6 row ">
                                <label class="col-md-5 control-label">审核状态</label>
                                <div class="col-md-6 rylist">
                                    <div class="statusstate"></div>
                                </div>
                            </div>
                            <div class="col-md-3 col-sm-6 row">
                                <label class="col-md-5 control-label">置顶状态</label>
                                <div class="col-md-6 rylist">
                                    <div class="stickstate"></div>
                                </div>
                            </div>
                            <div class="col-md-4 col-sm-6 row">
                                <label class="col-md-4 control-label">标题</label>
                                <div class="col-md-6 rylist">
                                    <input type="text" name="title" class="form-control width-150">
                                </div>
                            </div>
                            <div class="col-md-1 col-sm-4">
                                <button style="margin-top: 10px" class="btn btn-e" onclick="seek(this)">
                                    搜索
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-12">
                <div class="padding-l-10 f-s-17 bod  box-s bod-r-8 padding-t-10">
                    <a class="btn btn-e btn-wd" href="#/addmessagegerent" style="float:right; margin-right: 10px;">添加资讯</a>
                    <button class="btn btn-f btn-wd" onclick="deleteclass(this)">批量删除</button>
                </div>
            </div>
            <!--表格数据区-->
            <div class="container-fluid padding-t-20">
                <div class="row">
                    <div class="col-md-12 ">
                        <table class="table table-bordered table-hover">
                            <thead>
                            <tr>
                                <th><input class="fuxk" name="allcheck2" type="checkbox" value="" id="allcheck2"
                                           onclick="selectall(this)"/></th>
                                <th class="text-center cuti">标题</th>
                                <th class="text-center cuti">所属栏目</th>
                                <th class="text-center cuti">是否推荐/置顶</th>
                                <th class="text-center cuti">审核状态</th>
                                <th class="text-center cuti">发布状态</th>
                                <th class="text-center cuti">操作</th>
                            </tr>
                            </thead>
                            <tbody id="messagegerent"></tbody>
                        </table>
                        <div class="fenye">
                            <div class="pagination pagination0"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!--主站下发资讯-->
        <div id="company" class="tab-pane fade show" role="tabpanel" aria-labelledby="account-tab">
            <div class="col-md-12 row" style="margin-left: 6px;margin-bottom: 10px">
                <div class="dropdowns"></div>
                <div class="dropdowns" style="margin-left: 5px"></div>
            </div>
            <!--搜索区-->
            <div class="col-md-12">
                <div class="card horizontal-form">
                    <div class="card-body">
                        <div class="row col-md-12">
                            <div class="col-md-6 col-sm-6 row">
                                <ul class=" list-unstyled list-inline antime1 rylist row">
                                    <li class="fdong brokeragetime timecolor"
                                        style="width: 11% ;margin-left:39px;margin-right: 10px;">
                                        发布日期
                                    </li>
                                    <li class="" style="width: 35%">
                                        <input type="text" name="datastart" class="form-control datepicker"
                                               placeholder="选择日期"/>
                                    </li>
                                    <li class="fdong timecolor" style="width:5%;">到</li>
                                    <li class="" style="width: 35%">
                                        <input type="text" name="dataend" class="form-control datepicker"
                                               placeholder="选择日期"/>
                                    </li>
                                </ul>
                            </div>
                            <div class=" col-md-3 col-sm-6 row">
                                <div class="row rylist">
                                    <label class="col-md-4 control-label rylist">标题</label>
                                    <div class="col-md-7">
                                        <input type="text" name="title" class="form-control">
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3 col-sm-6 row">
                                <div class="col-md-6 rylist">
                                    <button class="btn btn-e" style="margin-left: 40px;height: 35px"
                                            onclick="seektwo(this)">搜索
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!--表格数据区-->
            <div class="container-fluid padding-t-20">
                <div class="row">
                    <div class="col-md-12 ">
                        <table class="table table-bordered table-hover">
                            <thead>
                            <tr>
                                <th class="text-center cuti">标题</th>
                                <th class="text-center cuti">所属栏目</th>
                                <th class="text-center cuti">是否推荐/置顶</th>
                                <th class="text-center cuti">发布日期</th>
                                <th class="text-center cuti">主站点</th>
                            </tr>
                            </thead>

                            <tbody id="lowermessagegerent"></tbody>
                        </table>
                        <div class="fenye">
                            <div class="pagination pagination1"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script type="text/html" id="messagegerent_t">
    {{each data}}
    <tr class="{{$value.articleId}}">
        <td><input class="fuxk" name="choose" type="checkbox" value="{{$value.articleId}}"/>
        </td>
        <!--改第一个tab表格抬头对应数据开始-->
        <td class="text-center"> {{$value.title}}</td>
        <td class="text-center">{{$value.createBy}}</td>
        <td class="text-center">
           <span data-pubStatus="{{$value.articleId}}">
                {{if $value.posid=="1"}}是{{else}}否{{/if}}
           </span>
            /
            <span data-weight="{{$value.articleId}}">
                {{if $value.weight=="999"}}是 {{else}}否 {{/if}}
            </span>
        </td>
        <td class="text-center" data-status="{{$value.status}}">
            {{if $value.status==0}}未提交
            {{else if $value.status==1}}审核中
            {{else if $value.status==2}}审核通过
            {{else if $value.status==2}}审核失败
            {{/if}}
        </td>
        <td class="text-center" data-status="{{$value.pubStatus}}">
            {{if $value.pubStatus==0}}未发布
            {{else if $value.pubStatus==1}}发布
            {{/if}}
        </td>
        <td class="text-center caozuo">
            <a href="javascript:void(0);" data-id="{{$value.articleId}}" data-type="{{$value.pubStatus}}"
               onclick="pubStatus(this)">
                {{if $value.pubStatus=="0"}}发布
                {{else}}取消发布
                {{/if}}</a>
            <a href="javascript:void(0);" data-id="{{$value.articleId}}"
               onclick="posid(this)">
                {{if $value.posid=="1"}}取消推荐
                {{else}}推荐
                {{/if}}
            </a>
            <a href="javascript:void(0);" data-id="{{$value.articleId}}"
               onclick="weight(this)" data-type="{{$value.weight}}">
                {{if $value.weight!="999"}}置顶
                {{else}}取消置顶
                {{/if}}
            </a>
            <a href="javascript:void(0);" data-id="{{$value.articleId}}"
               onclick="redact(this)">
                查看
            </a>
            <a href="javascript:void(0);" data-id="{{$value.articleId}}"
               onclick="onedel(this)">删除</a>
        </td>
    </tr>
    {{/each}}
</script>
<!--第二个tab表格数据模板区-->
<script type="text/html" id="lowermessagegerent_t">
    {{each data}}
    <tr class="{{$value.articleId}}">

        <td class="text-center"> {{$value.title}}</td>
        <td class="text-center">{{$value.createBy}}</td>
        <td class="text-center">
           <span data-pubStatus="{{$value.articleId}}">
                {{if $value.posid=="1"}}是{{else}}否{{/if}}
           </span>
            /
            <span data-weight="{{$value.articleId}}">
                {{if $value.weight=="999"}}是 {{else}}否 {{/if}}
            </span>
        </td>
        <td class="text-center" data-status="{{$value.updateDate}}">
            {{$value.updateDate}}
        </td>
        <td class="text-center" data-status="{{$value.siteId}}">
            {{$value.siteId}}
        </td>
    </tr>
    {{/each}}
</script>

<script>
    (function (window, $) {
        $('a[data-toggle="tab"]').on('shown.bs.tab', function (e) {
            var choldnode = $(".tab-content").children();
            for (let i = 0; i < choldnode.length; i++) {
                choldnode[i].style.display = "none"
            }
            $("#" + this.dataset.href + "")[0].style.display = "block";
        });

        utils_admin.delpostdata("articleId")
        var pagepostdata = utils_admin.clone(apidata.postdata);
        var pagepostdatatwo = utils_admin.clone(apidata.postdata);
        //列表1
        let pagedataone = utils_admin.setajax('POST', apidata.postdata, apidata.news.queryPage);
        utils_admin.queryPage("messagegerent", "messagegerent_t", pagedataone);
        //分页1
        new pagination({
            pagination: $('.pagination0'),//分页挂载的样式名称
            maxPage: 5, //最大页码数,支持奇数，左右对称
            startPage: 1,    //默认第一页
            currentPage: 1,          //当前页码
            totalPageCount: (pagedataone.totalCount / pagedataone.pageSize) - (pagedataone.totalCount / pagedataone.pageSize) % 1 + 1,  //总页数
            callback: function (pageNum) {
                pagepostdata.payload.page = "" + pageNum + "";
                //修改查询接口-apidata.news.queryPage
                utils_admin.queryPage("messagegerent", "messagegerent_t", utils_admin.setajax('POST', pagepostdata, apidata.news.queryPage));
            }
        });


        let pagedataone2 = utils_admin.setajax('POST', pagepostdatatwo, apidata.news.lowerSendPage);
        utils_admin.queryPage("lowermessagegerent", "lowermessagegerent_t", pagedataone2);
        new pagination({
            pagination: $('.pagination1'),//分页挂载的样式名称
            maxPage: 5, //最大页码数,支持奇数，左右对称
            startPage: 1,    //默认第一页
            currentPage: 1,          //当前页码
            totalPageCount: (pagedataone2.totalCount / pagedataone2.pageSize) - (pagedataone2.totalCount / pagedataone2.pageSize) % 1 + 1,  //总页数
            callback: function (pageNum) {
                pagepostdatatwo.payload.page = "" + pageNum + "";
                utils_admin.queryPage("lowermessagegerent", "lowermessagegerent_t", utils_admin.setajax('POST', pagepostdatatwo, apidata.news.lowerSendPage));
            }
        });

        window.utils_admin.calendar($('.datepicker'));

        //站点,平台初始化
        window.utils_admin.loadhtml($(".parentsitelist"), '/dropdown.html', {
            "header": "所有平台",
            "id": null,
            "body": window.parentSiteList,
            "width": 120,
            "name": "parentsitelist",
        });
        window.utils_admin.loadhtml($(".endchild"), '/dropdown.html', {
            "header": "先选择平台",
            "id": null,
            "body": null,
            "width": 120,
            "name": "endchild",
        });
        //站点
        $(".parentsitelist").click(function (a) {
            let id = '', endchild = [];
            if (a.target.nodeName.toLowerCase() == "li") {
                id = a.target.getAttribute("id")
            } else {
                id = window.parentSiteList[0].id
            }
            window.childSiteList.forEach((a) => {
                a.forEach((e, index) => {
                    if (e.ptId == id) {
                        endchild.push(e)
                        endchild[index].text = endchild[index].siteName;
                        endchild[index].id = endchild[index].siteId;
                    }
                })
            });
            window.utils_admin.loadhtml($(".endchild"), '/dropdown.html', {
                "header": endchild[0].text,
                "id": endchild[0].id,
                "body": endchild,
                "width": 120,
                "name": "endchild",
            });
        });
        $(".endchild").click(function (a) {
            pagepostdata.payload.siteId = utils_admin.downid(a, "endchild");
        });

        //栏目
        let newscategoryone = utils_admin.setajax('POST', pagepostdata, apidata.news.newsCategoryqueryPage);
        let newscategoryonearr = [];
        newscategoryone.data.forEach((a) => {
            a.text = a.catName;
            a.id = a.catId
            newscategoryonearr.push(a)
        });
        window.utils_admin.loadhtml($(".newscategoryone"), '/dropdown.html', {
            "header": "选择栏目",
            "id": null,
            "body": newscategoryonearr,
            "width": 135,
            "name": "newscategoryone",
        });

        $(".newscategoryone").click(function (a) {
            pagepostdata.payload.catId = utils_admin.downid(a, "newscategoryone");
        });

        //状态
        window.utils_admin.loadhtml($(".statusstate"), '/dropdown.html', {
            "header": "全部",
            "id": null,
            "body": [
                {
                    "text": "未提交",
                    "id": "0"
                },
                {
                    "text": "审核中",
                    "id": "1"
                },
                {
                    "text": "审核通过",
                    "id": "2"
                },
                {
                    "text": "审核失败",
                    "id": "3"
                }
            ],
            "width": 120,
            "name": "statusstate",
        });
        $(".statusstate").click(function (a) {
            pagepostdata.payload.status = utils_admin.downid(a, "statusstate");
        });

        //置顶
        window.utils_admin.loadhtml($(".stickstate"), '/dropdown.html', {
            "header": "全部",
            "id": null,
            "body": [
                {
                    "text": "置顶",
                    "id": "999"
                },
                {
                    "text": "未置顶",
                    "id": "0"
                },
            ],
            "width": 120,
            "name": "stickstate",
        });
        $(".stickstate").click(function (a) {
            pagepostdata.payload.weight = utils_admin.downid(a, "stickstate");
        });


        //搜索
        function seek(e) {
            let inputdata = $("input[type=text]");
            pagepostdata.payload.startDate = inputdata[0].value;
            pagepostdata.payload.endDate = inputdata[1].value;
            pagepostdata.payload.title = inputdata[2].value;
            utils_admin.queryPage("messagegerent", "messagegerent_t", utils_admin.setajax('POST', pagepostdata, apidata.news.queryPage));
        }

        //搜索two
        function seektwo(e) {
            let inputdata = $("input[type=text]");
            pagepostdatatwo.payload.startDate = inputdata[3].value;
            pagepostdatatwo.payload.endDate = inputdata[4].value;
            pagepostdatatwo.payload.title = inputdata[5].value;
            utils_admin.queryPage("lowermessagegerent", "lowermessagegerent_t", utils_admin.setajax('POST', pagepostdatatwo, apidata.news.lowerSendPage));
        }

        //全选
        function selectall(thit) {
            let checkboxs = document.getElementsByName("choose");
            if (thit.checked) {
                for (let i = 0; i < checkboxs.length; i++) {
                    let e = checkboxs[i];
                    e.checked = true;
                }
            } else {
                for (let i = 0; i < checkboxs.length; i++) {
                    let e = checkboxs[i];
                    e.checked = false;
                }
            }
        }

        //查看
        function redact(e) {
            utils_admin.redact("addmessagegerent", "articleId", e)
        }

        //发布
        function pubStatus (e) {
            pagepostdata.payload.articleId = e.dataset.id;
            if(e.dataset.type=='1'){
                pagepostdata.payload.pubStatus = '0';
            }else {
                pagepostdata.payload.pubStatus = '1';
            }
            utils_admin.setajax('POST', pagepostdata, apidata.news.publish)
            pagepostdata.payload.pubStatus='';
            utils_admin.queryPage("messagegerent", "messagegerent_t", utils_admin.setajax('POST', pagepostdata, apidata.news.queryPage));
        }
        //推荐
        function posid(e) {
            var id = e.dataset.id;
            pagepostdata.payload.articleId = id;
            utils_admin.setajax('POST', pagepostdata, apidata.news.recommend)
            pagepostdata.payload.articleId='';
            utils_admin.queryPage("messagegerent", "messagegerent_t", utils_admin.setajax('POST', pagepostdata, apidata.news.queryPage));
        }
        //置顶
        function weight (e) {
            var id = e.dataset.id;
            pagepostdata.payload.articleId = id;
            if(e.dataset.type=='999'){
                pagepostdata.payload.posid = "1";
                pagepostdata.payload.flag = '0';
            }else {
                pagepostdata.payload.flag = '1';
            }
            utils_admin.setajax('POST', pagepostdata, apidata.news.top)
            pagepostdata.payload.flag=''; pagepostdata.payload.posid = "";
            utils_admin.queryPage("messagegerent", "messagegerent_t", utils_admin.setajax('POST', pagepostdata, apidata.news.queryPage));
        }
        ///删除
        function onedel(e) {
            var id = e.dataset.id;
            pagepostdata.payload.articleId = id;
            $("#popups").toggle("hidden");
        }


        //批量删除
        function deleteclass(a) {
            $("#popups").toggle("hidden");
            pagepostdata.payload.articleId = utils_admin.choosevalue("messagegerent");
        }

        $("#popups>.white_content").click(function (a) {
            if (a.target.nodeName.toLowerCase() == "button") {
                $("#popups").toggle("hidden")
            }
            if (a.target.dataset.id=='1') {
                utils_admin.setajax('POST', pagepostdata, apidata.news.delete);
                utils_admin.queryPage("messagegerent", "messagegerent_t", utils_admin.setajax('POST', pagepostdata, apidata.news.queryPage));
            }
        });


        window.onedel = onedel;
        window.deleteclass = deleteclass;
        window.redact = redact;
        window.selectall = selectall;
        window.seek = seek;
        window.seektwo = seektwo;
        window.pubStatus=pubStatus;
        window.weight=weight;
        window.posid=posid;
    })(window, window.$);

</script>
