<div class="card-body">
    <ul role="tablist" class="nav nav-tabs col-md-12">
        <li role="presentation" class="nav-item show active col-md-6">
            <a class="nav-link" id="info-tab" href="#agency" data-toggle="tab">当前站点(子站)</a>
        </li>
        <li class="nav-item col-md-6">
            <a class="nav-link" id="account-tab" href="#company" data-toggle="tab">主站下发</a>
        </li>
    </ul>
    <div class="tab-content">
        <div id="agency" class="tab-pane fade show active" role="tabpanel" aria-labelledby="info-tab">
            <div class="col-md-12 row" style="
            margin-left: 6px;margin-bottom: 10px">
                <div class="parentsitelist"></div>
                <div class="endchild" style="margin-left: 5px"></div>
            </div>
            <div class="col-md-12">
                <div class="card horizontal-form">
                    <div class="card-body">
                        <div class="row col-md-12">
                            <div class="col-md-3 col-sm-6 row">
                                <label class="col-md-6 control-label">活动类型</label>
                                <div class="col-md-6 rylist">
                                    <div class="nowtype"></div>
                                </div>
                            </div>
                            <div class="col-md-3 col-sm-6 row" style="margin-left: 10px">
                                <label class="col-md-6 control-label">活动地区</label>
                                <div class="col-md-6 rylist">
                                    <div class="nowarea"></div>
                                </div>
                            </div>
                            <div class="col-md-3 col-sm-6 row" style="margin-left: 10px">
                                <label class="col-md-6 control-label">活动分类</label>
                                <div class="col-md-6 rylist">
                                    <div class="cateselect nowcate"></div>
                                </div>
                            </div>
                        </div>
                        <div class="row col-md-12">
                            <div class="col-md-8 col-sm-12">
                                <div class="row">
                                    <label class="col-md-2 control-label"
                                           style="text-align: center">&nbsp;&nbsp;活动名称</label>
                                    <div class="col-md-3 rylist">
                                        <input type="text" class="form-control ">
                                    </div>
                                    <div class="col-md-3 rylist">
                                        <div class="dropdowns nowname"></div>
                                    </div>
                                    <div class="col-md-2 col-sm-6">
                                        <button style="margin-top: 5px" index="1" class="btn btn-e btn-wd btn-search">搜索
                                        </button>
                                    </div>
                                </div>
                            </div>

                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-12">
                <div class="padding-l-10 f-s-17 bod  box-s bod-r-8 padding-t-10">
                    <a class="btn btn-e btn-wd" href="#/activityadd">添加活动</a>
                    <a class="btn btn-e btn-wd" href="#/uploadactivitygecolumn">成果上传</a>
                    <button class="btn btn-f btn-wd" data-type="now">批量删除</button>
                </div>
            </div>
            <div class="container-fluid padding-t-20">
                <div class="row">
                    <div class="col-md-12 ">
                        <table class="table table-bordered table-hover" id="tablecz">
                            <thead>
                            <tr>
                                <th><input class="fuxk" name="allcheck" type="checkbox" value="" id="allcheck"
                                           onclick="selectall()"/></th>
                                <th class="text-center cuti">活动主题</th>
                                <th class="text-center cuti">活动类型</th>
                                <th class="text-center cuti">活动地区</th>
                                <th class="text-center cuti">活动分类</th>
                                <th class="text-center cuti">发布人</th>
                                <th class="text-center cuti">状态</th>
                                <th class="text-center cuti">操作</th>
                            </tr>
                            </thead>
                            <tbody id="activitygecolumn"></tbody>
                        </table>
                        <div class="fenye">
                            <div class="pagination pagination0"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div id="company" class="tab-pane fade" role="tabpanel" aria-labelledby="account-tab">
            <div class="col-md-12 row" style="margin-left: 6px;margin-bottom: 10px">
                <div class="dropdowns"></div>
                <div class="dropdowns" style="margin-left: 5px"></div>
            </div>
            <div class="col-md-12">
                <div class="card horizontal-form">
                    <div class="card-body">
                        <div class="row col-md-12">
                            <div class="col-md-3 col-sm-6 row">
                                <label class="col-md-6 control-label">活动类型</label>
                                <div class="col-md-6 rylist">
                                    <div class="nowtype"></div>
                                </div>
                            </div>
                            <div class="col-md-3 col-sm-6 row" style="margin-left: 10px">
                                <label class="col-md-6 control-label">活动地区</label>
                                <div class="col-md-6 rylist">
                                    <div class="nowarea"></div>
                                </div>
                            </div>
                            <div class="col-md-3 col-sm-6 row" style="margin-left: 10px">
                                <label class="col-md-6 control-label">活动分类</label>
                                <div class="col-md-6 rylist">
                                    <div class="nowcate"></div>
                                </div>
                            </div>
                        </div>
                        <div class="row col-md-12">
                            <div class="col-md-8 col-sm-12">
                                <div class="row">
                                    <label class="col-md-2 control-label"
                                           style="text-align: center">&nbsp;&nbsp;活动名称</label>
                                    <div class="col-md-3 rylist">
                                        <input type="text" class="form-control">
                                    </div>
                                    <div class="col-md-3 rylist">
                                        <div class="nowname"></div>
                                    </div>
                                    <div class="col-md-2 col-sm-6">
                                        <button style="margin-top: 5px" index="2" class="btn btn-e btn-wd btn-search">搜索
                                        </button>
                                    </div>
                                </div>
                            </div>

                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-12">
                <div class="padding-l-10 f-s-17 bod  box-s bod-r-8 padding-t-10">
                    <a class="btn btn-e btn-wd" href="#/addactivitygecolumn">添加活动</a>
                    <a class="btn btn-e btn-wd" href="#/uploadactivitygecolumn">成果上传</a>
                    <button class="btn btn-f btn-wd delbatch"  data-type="master">批量删除</button>
                </div>
            </div>
            <div class="container-fluid padding-t-20">
                <div class="row">
                    <div class="col-md-12 ">
                        <table class="table table-bordered table-hover" id="tablecztwo">
                            <thead>
                            <tr>
                                <th><input class="fuxk" name="allcheck" type="checkbox" value="" id="allchecktwo"
                                           onclick="selectall()"/></th>
                                <th class="text-center cuti">活动主题</th>
                                <th class="text-center cuti">活动类型</th>
                                <th class="text-center cuti">活动地区</th>
                                <th class="text-center cuti">活动分类</th>
                                <th class="text-center cuti">发布人</th>
                                <th class="text-center cuti">状态</th>
                                <th class="text-center cuti">操作</th>
                            </thead>
                            <tbody id="activitygecolumntwo"></tbody>

                        </table>
                        <div class="fenye">
                            <div class="pagination pagination1"></div>

                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script type="text/html" id="activitygecolumn_t">
    {{each data}}
    <tr class="{{$value.actId}}">
        <td><input class="fuxk" name="choose" type="checkbox" value="{{$value.actId}}"/>
        </td>
        <!--改第一个tab表格抬头对应数据开始-->
        <td class="text-center"> {{$value.actTitle}}</td>
        <td class="text-center">
            {{if $value.actType==1}}宣传活动
            {{else if $value.actType==2}}评比类活动
            {{/if}}
        </td>
        <td class="text-center">
            {{$value.actAreaId}}
        </td>
        <td class="text-center">
            {{$value.actAreaId}}
        </td>
        <td class="text-center">
            {{$value.createBy}}
        </td>
        <td class="text-center" data-status="{{$value.actStatus}}">
            {{if $value.actStatus==0}}未提交
            {{else if $value.actStatus==1}}审核中
            {{else if $value.actStatus==2}}审核通过
            {{else if $value.actStatus==3}}审核失败
            {{else if $value.actStatus==4}}不需要审核
            {{/if}}
        </td>

        <!--改第一个tab表格抬头对应数据结束-->
        <!--单行操作区-根据具体页面选择对应按钮修，不需要的注释-->
        <td class="text-center caozuo">
            <a href="javascript:void(0);" data-type="now" data-pubStatus="{{$value.pubStatus=='0'?1:0}}" data-id="{{$value.articleId}}"
               onclick="pubStatus(this)">
                {{if $value.actStatus=="2" && $value.pubStatus!="1"}}发布
                {{else if $value.pubStatus="1"}}取消发布
                {{/if}}</a>
            <a href="javascript:void(0);" data-id="{{$value.actId}}"
               onclick="view(this)">
                预览</a>
            <a href="javascript:void(0);" data-id="{{$value.actId}}"
               onclick="result(this)">
                成果管理
            </a>
            <a href="javascript:void(0);" data-type="now" data-id="{{$value.actId}}"
               onclick="deleteById(this)">{{if $value.actStatus=="0"}}删除{{/if}}</a>
        </td>
    </tr>
    {{/each}}
</script>

<script type="text/html" id="activitygecolumntwo_t">
    {{each data}}
    <tr class="{{$value.actId}}">
        <td><input class="fuxk" name="choose" type="checkbox" value="{{$value.actId}}"/>
        </td>
        <!--改第一个tab表格抬头对应数据开始-->
        <td class="text-center"> {{$value.actTitle}}</td>
        <td class="text-center">
            {{if $value.actType==1}}宣传活动
            {{else if $value.actType==2}}评比类活动
            {{/if}}
        </td>
        <td class="text-center">
            {{$value.actAreaId}}
        </td>
        <td class="text-center">
            {{$value.actAreaId}}
        </td>
        <td class="text-center">
            {{$value.createBy}}
        </td>
        <td class="text-center" data-status="{{$value.actStatus}}">
            {{if $value.actStatus==0}}未提交
            {{else if $value.actStatus==1}}审核中
            {{else if $value.actStatus==2}}审核通过
            {{else if $value.actStatus==3}}审核失败
            {{else if $value.actStatus==4}}不需要审核
            {{/if}}
        </td>

        <!--改第一个tab表格抬头对应数据结束-->
        <!--单行操作区-根据具体页面选择对应按钮修，不需要的注释-->
        <td class="text-center caozuo">
            <a href="javascript:void(0);" data-id="{{$value.actId}}"
               onclick="actStatus(this)">
                {{if $value.actStatus=="0"}}提交审核
                {{else if $value.actStatus=="1"}}审核
                {{/if}}</a>
            <a href="javascript:void(0);" data-type="master" data-pubStatus="{{$value.pubStatus=='0'?1:0}}" data-id="{{$value.articleId}}"
               onclick="pubStatus(this)">
                {{if $value.actStatus=="2" && $value.pubStatus!="1"}}发布
                {{else if $value.pubStatus="1"}}取消发布
                {{/if}}</a>
            <a href="javascript:void(0);" data-id="{{$value.actId}}"
               onclick="view(this)">
                预览</a>
            <a href="javascript:void(0);" data-id="{{$value.actId}}"
               onclick="result(this)">
                成果管理
            </a>
            <a href="javascript:void(0);" data-type="master" data-id="{{$value.actId}}"
               onclick="deleteById(this)">{{if $value.actStatus=="0"}}删除{{/if}}</a>
        </td>
    </tr>
    {{/each}}
</script>

<script>
    (function (window, $) {
        var catePostdata = apidata.postdata;
        //全局变量now 为当前站点 master为下发列表
        var type="now";
        //列表1  修改查询接口-apidata.news.queryPage
        let pagedataone = utils_admin.setajax('POST', apidata.postdata, apidata.activity.activitylist);
        console.log("data", pagedataone)
        utils_admin.queryPage("activitygecolumn", "activitygecolumn_t", pagedataone);
        //分页1
        new pagination({
            pagination: $('.pagination0'),//分页挂载的样式名称
            maxPage: 5, //最大页码数,支持奇数，左右对称
            startPage: 1,    //默认第一页
            currentPage: 1,          //当前页码
            totalPageCount: (pagedataone.totalCount / pagedataone.pageSize) - (pagedataone.totalCount / pagedataone.pageSize) % 1 + 1,  //总页数
            callback: function (pageNum) {
                apidata.postdata.payload.page = "" + pageNum + "";
                //修改查询接口-apidata.news.queryPage
                utils_admin.queryPage("activitygecolumn", "activitygecolumn_t", utils_admin.setajax('POST', apidata.postdata, apidata.activity.activitylist));
            }
        });

        //列表2  修改查询接口-apidata.news.queryPage
        let pagedatatwo = utils_admin.setajax('POST', apidata.postdata, apidata.activity.activitylist);
        console.log("data", pagedataone);
        utils_admin.queryPage("activitygecolumntwo", "activitygecolumntwo_t", pagedatatwo);
        //分页2
        new pagination({
            pagination: $('.pagination1'),//分页挂载的样式名称
            maxPage: 5, //最大页码数,支持奇数，左右对称
            startPage: 1,    //默认第一页
            currentPage: 1,          //当前页码
            totalPageCount: pagedataone.pageSize,  //总页数
            callback: function (pageNum) {
                apidata.postdata.payload.page = "" + pageNum + "";
                //修改查询接口-apidata.news.queryPage
                utils_admin.queryPage("activitygecolumn", "activitygecolumn_t", utils_admin.setajax('POST', apidata.postdata, apidata.activity.activitylist));
            }
        });


        window.utils_admin.calendar($('.datepicker'));
        //站点,平台初始化
        window.utils_admin.loadhtml($(".parentsitelist"), '/dropdown.html', {
            "header": "所有平台",
            "id": null,
            "body": window.parentSiteList,
            "width": 120,
            "name": "parentsitelist",
        });


        window.utils_admin.loadhtml($(".endchild"), '/dropdown.html', {
            "header": "先选择平台",
            "id": null,
            "body": null,
            "width": 120,
            "name": "endchild",
        });
        //换站点
        $(".parentsitelist").click(function (a) {
            let id = '', endchild = [];
            if (a.target.nodeName.toLowerCase() == "li") {
                id = a.target.getAttribute("id")
            } else {
                id = window.parentSiteList[0].id
            }
            window.childSiteList.forEach((a) => {
                a.forEach((e, index) => {
                    if (e.ptId == id) {
                        endchild.push(e)
                        endchild[index].text = endchild[index].siteName;
                        endchild[index].id = endchild[index].siteId;
                    }
                })
            });
            window.utils_admin.loadhtml($(".endchild"), '/dropdown.html', {
                "header": endchild[0].text,
                "id": endchild[0].id,
                "body": endchild,
                "width": 120,
                "name": "endchild",
            });
        });
        //初始化分类接口
        var categoryList = utils_admin.setajax('POST', catePostdata, apidata.activity.actCategory);
        var cateArr = [];
        var result = categoryList.data;
        result.forEach(function (a, index) {
            var data = {};
            data.id = a.catId;
            data.text = a.catName;
            cateArr.push(data);
        })
        window.utils_admin.loadhtml($(".cateselect"), '/dropdown.html', {
            "header": "请选择",
            "id": null,
            "body": cateArr,
            "width": 120,
            "name": "cateselect",
        });

        $(".cateselect").click(function (a) {
            let id = '', endchild = [];
            if (a.target.nodeName.toLowerCase() == "li") {
                id = a.target.getAttribute("id")
            } else {
                id = window.parentSiteList[0].id
            }
            catePostdata.payload.catId = id;
        });

        //选择活动类型
        window.utils_admin.loadhtml($(".nowtype"), '/dropdown.html', {
            "header": "请选择",
            "id": null,
            "body": window.parentSiteList,
            "width": 105,
            "name": "nowtype",
        });
        $(".nowtype").click(function (a) {
            let id = '', endchild = [];
            if (a.target.nodeName.toLowerCase() == "li") {
                id = a.target.getAttribute("id")
            } else {
                id = window.parentSiteList[0].id
            }
            catePostdata.payload.catId = id;
        });

        //活动地区
        window.utils_admin.loadhtml($(".nowarea"), '/dropdown.html', {
            "header": "请选择",
            "id": null,
            "body": window.parentSiteList,
            "width": 105,
            "name": "nowarea",
        });
        $(".nowarea").click(function (a) {
            let id = '', endchild = [];
            if (a.target.nodeName.toLowerCase() == "li") {
                id = a.target.getAttribute("id")
            } else {
                id = window.parentSiteList[0].id
            }
            catePostdata.payload.actAreaId = id;
        });
        //当前站点活动查询
        $(".btn-search").click(function (a) {
            var inputdata = $("input[type=text]");
            var index = $(this).attr("index");
            //当index为1时是当前站点所有活动 2时是主站下发时的
            if (index == "1") {
                catePostdata.payload.actTitle = inputdata[0].value;
                utils_admin.queryPage("activitygecolumn", "activitygecolumn_t", utils_admin.setajax('POST', catePostdata, apidata.activity.activitylist));
            } else if (index == "2") {
                catePostdata.payload.actTitle = inputdata[0].value;
                utils_admin.queryPage("activitygecolumn", "activitygecolumn_t", utils_admin.setajax('POST', catePostdata, apidata.activity.sendLowerPage));
            }
        });

        //审核
        function actStatus(e) {
            //判断该用户是不是管理员，是管理员审核状态传2直接审核通过，不是管理员传1
            var actId = e.dataset.id;
            var status = 1;

            catePostdata.payload.actId = actId;
            catePostdata.payload.actStatus = status;
            var result = utils_admin.setajax('POST', catePostdata, apidata.activity.activitySumbitAudit);
        }

        //删除单条记录
        function deleteById(e) {
            var actId = e.dataset.id;
             type=e.dataset.type;
            catePostdata.payload.actId=actId;
            $("#popups").toggle("hidden");
        }

        //批量删除活动
        $(".delbatch").click(function (a) {
            type=e.dataset.type;
            var ids = $("#popups").toggle("hidden")
        });
        $("#popups>.white_content").click(function (a) {
            if (a.target.nodeName.toLowerCase() == "button") {
                $("#popups").toggle("hidden")
            }
            if(a.target.dataset.id){
                utils_admin.setajax('POST', catePostdata, apidata.activity.activityDel);
                if(type="now"){
                    utils_admin.queryPage("activitygecolumn", "activitygecolumn_t", utils_admin.setajax('POST', catePostdata, apidata.activity.activitylist));
                }else{
                    utils_admin.queryPage("activitygecolumn", "activitygecolumn_t", utils_admin.setajax('POST', catePostdata, apidata.activity.sendLowerPage));
                }
            }
        });
        //活动发布/取消发布
        function pubStatus(e) {
            var actId = e.dataset.id;
            var pubStatus = e.dataset.pubStatus;
            catePostdata.payload.pubStatus = pubStatus;
            utils_admin.setajax('POST', catePostdata, apidata.activity.activityPublish);
            utils_admin.queryPage("activitygecolumn", "activitygecolumn_t", utils_admin.setajax('POST', catePostdata, apidata.activity.activitylist));
        }

        //活动预览
        function view(e) {
            utils_admin.redact("activityadd", "actId", e)
        }

        //成果管理
        function result(e) {
            utils_admin.redact("activityadd", "actId", e)
        }

        //主站下发资讯的栏目-不用考虑
        window.utils_admin.loadhtml($(".companynewscateone"), '/dropdown.html', {
            "heard": "栏目一",
            "id": null,
            "body": [
                {
                    "text": "置顶",
                    "id": "1"
                },
                {
                    "text": "未置顶",
                    "id": "2"
                },
            ],
            "width": 120,
            "name": "stickstate",
        });
        //主站下发资讯的审核状态-不用考虑
        window.utils_admin.loadhtml($(".companynewscatetwo"), '/dropdown.html', {
            "heard": "栏目二",
            "id": null,
            "body": [
                {
                    "text": "置顶",
                    "id": "1"
                },
                {
                    "text": "未置顶",
                    "id": "2"
                },
            ],
            "width": 120,
            "name": "stickstate",
        });
        //主站下发资讯的审核状态-不用考虑
        window.utils_admin.loadhtml($(".all"), '/dropdown.html', {
            "heard": "全部",
            "id": "0",
            "body": [
                {
                    "text": "未抓取",
                    "id": "1"
                },
                {
                    "text": "已抓取",
                    "id": "2"
                },
            ],
            "width": 120,
            "name": "stickstate",
        });
        window.deleteById = deleteById;
    })(window, window.$);

</script>