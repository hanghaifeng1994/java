<div class="horizontal-form">
    <div class="card-body">
        <div class="form-group col-xl-12 padding-t-10">
            <div class="row">
                <label class="col-md-2 control-label brokeragetime">上传广告图片</label>
                <div class="col-md-10">
                    <div class="con4">
                        <div id="cvstwo" class="imgcanvas"></div>
                        <span class="btn upload">上传<input type="file" class="upload_pic" id="uploadtwo"/></span>
                    </div>
                </div>
            </div>
        </div>
        <div class="form-group col-xl-12 padding-t-10">
            <div class="row">
                <label class="col-md-2 control-label brokeragetime">标题</label>
                <div class="col-md-4">
                    <input type="text" placeholder="输入标题" class="form-control">
                </div>
            </div>
        </div>
        <div class="form-group col-xl-12 padding-t-10">
            <div class="row">
                <label class="col-md-2 control-label brokeragetime">图片链接</label>
                <div class="col-md-4">
                    <input type="text" placeholder="输入地址" class="form-control">
                </div>
            </div>
        </div>

        <div class="form-group col-xl-12 padding-t-10">
            <div class="row">
                <label class="col-md-2 control-label brokeragetime">所属平台</label>
                <div class="col-md-9 row rylist">
                    <div class="col-md-3">
                        <div class="parentsitelist "></div>
                    </div>
                    <div class="col-md-3">
                        <div class="endchild"></div>
                    </div>
                </div>
            </div>
        </div>
        <div class="form-group col-xl-12 padding-t-10">
            <div class="row">
                <label class="col-md-2 control-label brokeragetime">排列顺序</label>
                <div class="col-md-4">
                    <input type="number" placeholder="输入序号" class="form-control">
                </div>
            </div>
        </div>
        <div class="form-group col-xl-12 padding-t-20">
            <div class="row">
                <div class="col-md-2"></div>
                <div class="col-md-10 row">
                    <div class="col-md-2">
                        <button type="submit" class="btn btn-fill btn-e">保存并添加</button>
                    </div>
                    <div class="col-md-2">
                        <a href="/admin/views/index.html#/indeximages" class="btn  btn-e">返回</a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    (function (window) {
        var pagepostdata = utils_admin.clone(apidata.postdata);
        pagepostdata.payload.serviceType = "ad";
        var newdata = '';
        var inputwo = window.document.getElementById("uploadtwo");
        var canvastwo = window.document.getElementById("cvstwo");
        if (pagepostdata.payload.id) {
            let inputdata = $("input[type=text]");
            newdata = utils_admin.setajax('POST', pagepostdata, apidata.setting.squeryById).data;
            inputdata[0].value = newdata.title;
            inputdata[1].value = newdata.url;
            $("input[type=number]").val(newdata.sort);
            pagepostdata.payload.ptId = newdata.ptId;
            pagepostdata.payload.siteId = newdata.siteId;
            pagepostdata.payload.photo = "1";
            utils_admin.returnimg(canvastwo, newdata.imgs);

        }

        //上传图片
        window.utils_admin.setimg(inputwo, canvastwo, function (setdata) {
            pagepostdata.payload.photo = "1";
            pagepostdata.payload.imgs = setdata.data.fileId;
            pagepostdata.payload.actImgs = setdata.data.fileId;
            utils_admin.returnimg(canvastwo, setdata.data.fileUrl);
        });
        //站点,平台初始化
        window.utils_admin.loadhtml($(".parentsitelist"), '/dropdown.html', {
            "header": newdata ? newdata.ptName : "所有平台",
            "id": newdata ? newdata.ptId : null,
            "body": window.parentSiteList,
            "width": 120,
            "name": "parentsitelist",
        });
        window.utils_admin.loadhtml($(".endchild"), '/dropdown.html', {
            "header": newdata ? newdata.siteName : "先选择平台",
            "id": newdata ? newdata.siteId : null,
            "body": null,
            "width": 120,
            "name": "endchild",
        });
        //换站点
        $(".parentsitelist").click(function (a) {
            let id = '', endchild = [];
            if (a.target.nodeName.toLowerCase() == "li") {
                id = a.target.getAttribute("id")
            } else {
                id = window.parentSiteList[0].id
            }
            window.childSiteList.forEach((a) => {
                a.forEach((e, index) => {
                    if (e.ptId == id) {
                        endchild.push(e)
                        endchild[index].text = endchild[index].siteName;
                        endchild[index].id = endchild[index].siteId;
                    }
                })
            });
            pagepostdata.payload.siteId = endchild[0].id
            window.utils_admin.loadhtml($(".endchild"), '/dropdown.html', {
                "header": endchild[0].text,
                "id": endchild[0].id,
                "body": endchild,
                "width": 120,
                "name": "endchild",
            });
        });
        $(".endchild").click(function (a) {
            pagepostdata.payload.siteId = utils_admin.downid(a, "endchild");
        });

        $("button").click(function (a) {
            let inputdata= $("input[type=text]");
            pagepostdata.payload.title=inputdata[0].value;
            pagepostdata.payload.url = inputdata[1].value;
            pagepostdata.payload.sort = $("input[type=number]").val();
            var succdata = '';
            if (pagepostdata.payload.photo == "0") {
                alert("图片正在上传");
                return false
            }
            if (pagepostdata.payload.id) {
                succdata = utils_admin.setajax('POST', pagepostdata, apidata.setting.supdate)
            } else {
                succdata = utils_admin.setajax('POST', pagepostdata, apidata.setting.ssave)
            }
            utils_admin.setajax('POST', pagepostdata, apidata.setting.saveSorts)
            if (succdata.success = "1") {
                alert("成功");
                location.href = "/admin/views/index.html#/indeximages";
            }
        })
    })(window)
</script>