<div class="horizontal-form">
    <div class="card-body">
        <div class="form-group col-xl-12 padding-t-10">
            <div class="row">
                <label class="col-md-2 control-label brokeragetime">角色名称</label>
                <div class="col-md-4">
                    <input type="text" placeholder="" class="form-control">
                </div>
                <div class="col-md-1 text-danger">*</div>
            </div>
        </div>
        <div class="form-group col-xl-12 col-md-12 padding-t-10" style="margin-left: 20px">
            <div class="row">
                <div class="col-lg-12 col-sm-12">
                    <label class="col-md-12">公共模块权限配置</label>
                    <div style="margin-left: 20px;background-color: #F7F7F7;padding: 5px">
                        <ul id="treeDemo" class="ztree"></ul>
                    </div>
                </div>
            </div>
        </div>

        <div class="form-group col-xl-12 padding-t-20">
            <div class="row">
                <div class="col-xl-3"></div>
                <div class="col-md-6">
                    <button type="submit" class="btn btn-fill  btn-e" onclick="addmessageg()">保存并添加</button>
                </div>
            </div>
        </div>
    </div>
</div>


<script type="text/javascript">
    (function (window) {
        var pagepostdata= utils_admin.clone(apidata.postdata);
        if(pagepostdata.payload.roleId){
            let inputdata = $("input[type=text]");
            var roleFormdata=utils_admin.setajax('POST', pagepostdata, apidata.base.roleForm);
            inputdata[0].value=roleFormdata.data.roleName;
            utils_admin.delpostdata("roleId");
        }
        var datalist=utils_admin.setajax('POST', pagepostdata, apidata.base.cfgFunction);
        datalist.data.forEach((a)=>{
            a.name=a.funcName;
            a.id=a.funcId;
            a.pId=a.parentId;
            a.open=true;
            a.isParent= true;
            a.children.forEach((c)=>{
                c.name=c.funcName;
                c.id=c.funcId;
                c.pId=c.parentId;
            });
        });
        var setting = {
            view: {
                selectedMulti: false,
                showLine: false,
                showIcon: false,
            },
            check: {
                enable: true,
                chkboxType: {
                    "Y": "s", "N": "s"
                }
            },
            data: {
                simpleData: {
                    enable: true
                }
            },
            edit: {
                enable: false
            },
            callback: {
                beforeCheck: true,
                onCheck: onCheck
            }
        };
        function onCheck(e,treeId,treeNode) {
            let treeObj = $.fn.zTree.getZTreeObj("treeDemo"),
                nodes = treeObj.getCheckedNodes(true),
                v = "";
            for (let i = 0; i < nodes.length; i++) {
                v += nodes[i].id + ",";
                pagepostdata.payload.funcIds=v;
            }
        }
        $.fn.zTree.init($("#treeDemo"),setting,datalist.data);

        function addmessageg() {
            let inputdata = $("input[type=text]");
            if(inputdata[0].value){
                pagepostdata.payload.roleName = inputdata[0].value;
                utils_admin.setajax('POST', apidata.postdata, apidata.base.custRole)
                window.location.href='/admin/views/index.html#/userrole'
            }else {
                alert("必填")
            }
        }

        window.addmessageg=addmessageg;
    })(window)
</script>