<div class="col-md-12">
    <div class="col-md-12 row" style="padding-top: 10px">
        <div class="col-md-6 col-xs-12 row">
            <div class="col-md-10 row">
                <label class="col-md-4 control-label">所属测验</label>
                <span id="mchtname"></span>
            </div>
        </div>
        <div class="col-md-6 col-xs-12 row ">
            <div class="col-md-12 col-xs-12">
                <a class="btn btn-e btn-wd" href="javascript:;" onclick="addques(this)">新增组卷规则</a>
            </div>
        </div>
    </div>
    <div class="container-fluid padding-t-20">
        <div class="row">
            <div class="col-md-12 ">
                <table class="table table-bordered table-hover" id="tablecz">
                    <thead>
                    <tr>
                        <th class="text-center cuti">创建时间</th>
                        <th class="text-center cuti">是否用于测验</th>
                        <th class="text-center cuti">出卷数量</th>
                        <th class="text-center cuti">总分</th>
                        <th class="text-center cuti">是否已组卷</th>
                        <th class="text-center cuti">操作</th>
                    </tr>
                    </thead>
                    <tbody id="grouplist"></tbody>
                </table>
                <div class="fenye">
                    <div class="pagination pagination0"></div>
                </div>
            </div>
        </div>
    </div>
</div>
<script type="text/html" id="grouplist_t">
    {{each data}}
    <tr class="{{$value.paperRuleId}}">
        <td class="text-center">{{$value.createDate}}</td>
        <td class="text-center">
            {{if $value.tsId=='0'}}
            否
            {{else}}
            是
            {{/if}}
        </td>
        <td class="text-center">{{$value.queNum}}</td>
        <td class="text-center">
            {{$value.totalScore}}
        </td>
        <td class="text-center">
            {{if $value.isNewversion==$value.version}}
            是
            {{else}}
            否
            {{/if}}
        </td>
        <td class="text-center caozuo">
            <a href="javascript:void(0);" data-id="{{$value.paperRuleId}}"
               onclick="groupgo(this)">
                组卷
            </a>
            <a href="javascript:void(0);" data-id="{{$value.paperRuleId}}"
               onclick="check(this)">
                编辑
            </a>
            <a href="javascript:void(0);" data-id="{{$value.paperRuleId}}"
               onclick="onedel(this)">删除</a>
        </td>
    </tr>
    {{/each}}
</script>

<script>
    (function (window) {
        utils_admin.delpostdata("paperRuleId");
        var pagepostdata = utils_admin.clone(apidata.postdata);
        var datapagename = utils_admin.setajax('POST', pagepostdata, apidata.testing.testingtest);
        $("#mchtname").text(datapagename.data.name);
        var pagedataone = utils_admin.setajax('POST', pagepostdata, apidata.testing.queryManagePage);
        utils_admin.queryPage("grouplist", "grouplist_t", pagedataone);
        new pagination({
            pagination: $('.pagination0'),
            maxPage: 5,
            startPage: 1,    //默认第一页
            currentPage: 1,          //当前页码
            totalPageCount: (pagedataone.totalCount / pagedataone.pageSize) - (pagedataone.totalCount / pagedataone.pageSize) % 1 + 1,  //总页数
            callback: function (pageNum) {
                pagepostdata.payload.page = "" + pageNum + "";
                utils_admin.queryPage("grouplist", "grouplist_t", utils_admin.setajax('POST', pagepostdata, apidata.testing.queryManagePage));
            }
        });

        //新增组卷
        function addques() {
            utils_admin.delpostdata("paperRuleId");
            window.location.href = "/admin/views/index.html#/addgrouplist"
        }

        //编辑
        function check(e) {
            utils_admin.redact("addgrouplist", "paperRuleId", e)
        }

        //删除
        function onedel(e) {
            $("#popups").toggle("hidden");
            var id = e.dataset.id;
            pagepostdata.payload.paperRuleId = id;
        }

        $("#popups>.white_content").click(function (a) {
            if (a.target.nodeName.toLowerCase() == "button") {
                $("#popups").toggle("hidden")
            }
            if (a.target.dataset.id == "1") {
                utils_admin.setajax('POST', pagepostdata, apidata.testing.deletetest);
                utils_admin.queryPage("grouplist", "grouplist_t", utils_admin.setajax('POST', pagepostdata, apidata.testing.queryManagePage));
            }
        });

        //组卷
        function groupgo(e) {
            var id = e.dataset.id;
            pagepostdata.payload.paperRuleId = id;
            var datapagename = utils_admin.setajax('POST', pagepostdata, apidata.testing.saveGenPaper);
            if (datapagename.data.status == '1') {
                alert(datapagename.data.msg)
            }else {
                alert("成功组卷");
                utils_admin.queryPage("grouplist", "grouplist_t", utils_admin.setajax('POST', pagepostdata, apidata.testing.queryManagePage));
            }
        }

        window.onedel = onedel;
        window.check = check;
        window.addques = addques;
        window.groupgo = groupgo;
    })(window)
</script>