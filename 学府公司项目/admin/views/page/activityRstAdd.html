<div class="col-md-12">
    <div class="horizontal-form">
        <div class="card-body">
            <div class="form-group col-xl-12 padding-t-10">
                <div class="row">
                    <label class="col-md-2 control-label brokeragetime">成果名称</label>
                    <div class="col-md-4">
                        <input type="text" placeholder="填写标题" class="form-control">
                    </div>
                    <div class="col-md-1 text-danger">*</div>
                </div>
            </div>
            <div class="form-group col-xl-12 padding-t-10">
                <div class="row">
                    <label class="col-md-2 control-label brokeragetime">成果内容</label>
                    <div class="col-md-10">
                        <textarea style="resize: none; min-height:200px;width: 100%;border:1px solid #E4E4E4" cols="5"
                                  rows="5"></textarea>
                    </div>
                </div>
            </div>
            <div class="form-group col-xl-12 padding-t-10 isView">
                <div class="row">
                    <label class="col-md-2 control-label brokeragetime">附件</label>
                    <div class="col-md-10">
                            <span id="uploadImg">
                                <input type="file" id="file" size="1">
                                <a href="#">上传文件</a>
                            </span>
                        <p id="em">未上传</p>
                    </div>
                </div>
            </div>
            <div class="form-group col-xl-12 padding-t-20 isView">
                <div class="row">
                    <div class="col-md-2"></div>
                    <div class="col-md-4">
                        <button type="submit" class="btn btn-fill  btn-e" onclick="savemessageg(this)">保存并提交</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>


<script>
    (function (window, $) {
        var pagepostdata = apidata.postdata;
        let setdata={};
        if(pagepostdata.payload.rstId){
            setdata = utils_admin.setajax('POST', pagepostdata, apidata.activity.actResultQueryById).data;
            apidata.postdata.payload.rstId="";
            console.log(setdata);
            let inputdata = $("input[type=text]");
            inputdata[0].value=setdata.rstTitle;
            $("textarea").val(setdata.rstContent);
            $(".isView").css("display","none");
        }
        //上传附件
        $('#file').on('change', function (e) {
            var setdataform = e.currentTarget.files[0],
                name = setdataform.name,
                type = (setdataform.name.substr(setdataform.name.lastIndexOf("."))).toLowerCase();
            if (type == ".xls" || type == ".doc" || type == ".xlsx" || type == ".docx" && setdataform.size / 1024 / 1024 < 10) {
                $('#em').text("正在上传中...");
                pagepostdata.payload.fileIds = 0;
                var formData = new FormData();
                formData.append('imgFile', setdataform);
                $.ajax({
                    url: apidata.file.file,
                    type: 'POST',
                    data: formData,
                    cache: false,
                    contentType: false,
                    processData: false,
                    success: function (e) {
                        if (e.success == "1") {
                            $('#em').text(e.data.fileName + " 上传成功");
                            pagepostdata.payload.fileIds = e.data.fileId;
                            pagepostdata.payload.fileIdNames = e.data.fileName
                        } else {
                            $('#em').text("上传失败");
                        }
                    },
                    error: function (e) {
                        $('#em').text("上传失败");
                    }
                })
            } else {
                alert("请选择xls,xlsx,doc,docx文件格式,并不能大于10m");
                return false;
            }
        });

        //保存数据
        function savemessageg(e){
            let inputdata = $("input[type=text]");
            if(inputdata==""){
                alert("请填写活动成果名称");
                return false;
            }
            pagepostdata.payload.rstTitle=inputdata[0].value;
            pagepostdata.payload.rstContent= $("textarea").val();
            console.log(pagepostdata.payload);
            var result= utils_admin.setajax('POST', pagepostdata, apidata.activity.actResultsSave);
            var id =result.data.id;
            pagepostdata.payload.rstId=id;
            pagepostdata.payload.rstStatus="1";
            //提交审核
            utils_admin.setajax('POST', pagepostdata, apidata.activity.actResultSumbitAudit);
            pagepostdata.payload.rstTitle="";
            pagepostdata.payload.rstStatus="";
            window.location.href = "/admin/views/index.html#/gecolumn"
        }
        window.savemessageg = savemessageg;
    })(window, window.$)
</script>