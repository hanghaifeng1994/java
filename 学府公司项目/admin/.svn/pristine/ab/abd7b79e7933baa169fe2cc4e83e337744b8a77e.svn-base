<div class="col-md-12">
    <div class="horizontal-form">
        <div class="card-body">
            <div class="form-group col-xl-12 padding-t-10">
                <div class="row">
                    <label class="col-md-2 control-label brokeragetime">所属平台</label>
                    <div class="col-md-4">
                        <div class="parentsitelist"></div>
                    </div>
                </div>
            </div>
            <div class="form-group col-xl-12 padding-t-10">
                <div class="row">
                    <label class="col-md-2 control-label brokeragetime">网站类型</label>
                    <div class="col-md-4">
                        <div class="endchild"></div>
                    </div>
                </div>
            </div>
            <div class="form-group col-xl-12 padding-t-10">
                <div class="row">
                    <label class="col-md-2 control-label brokeragetime">站点名称</label>
                    <div class="col-md-4">
                        <input type="text" placeholder="" class="form-control">
                    </div>
                </div>
            </div>
            <div class="form-group col-xl-12 padding-t-10">
                <div class="row">
                    <label class="col-md-2 control-label brokeragetime">站点域名</label>
                    <div class="col-md-4">
                        <input type="text" placeholder="" class="form-control">
                    </div>
                </div>
            </div>
            <div class="form-group col-xl-12 padding-t-10">
                <div class="row">
                    <label class="col-md-2 control-label brokeragetime">站点编码</label>
                    <div class="col-md-4">
                        <input type="text" placeholder="" class="form-control">
                    </div>
                </div>
            </div>
            <div class="form-group col-xl-12 padding-t-10">
                <div class="row">
                    <label class="col-md-2 control-label brokeragetime">是否启用</label>
                    <div class="col-md-4">
                        <div class="dropdowns1 "></div>
                    </div>
                </div>
            </div>
            <div class="form-group col-xl-12 padding-t-10">
                <div class="row">
                    <label class="col-md-2 control-label brokeragetime">站点logo图片</label>
                    <div class="col-md-2">
                        <span class="btn upload">选择图片<input type="file" class="upload_pic" id="upload1"/></span>
                        <div class="col-md-2 rylist">&nbsp;&nbsp;</div>
                    </div>
                </div>
            </div>
            <div class="form-group col-xl-12 padding-t-10">
                <div class="row">
                    <label class="col-md-2 control-label brokeragetime"></label>
                    <canvas id="cvs1" width="150" height="150" style="border: 1px solid #E4E4E4;
    margin: 10px 0 20px 10px;"></canvas>
                </div>
            </div>
            <div class="form-group col-xl-12 padding-t-10">
                <div class="row">
                    <label class="col-md-2 control-label brokeragetime">头部背景图</label>
                    <div class="col-md-2">
                        <span class="btn upload">选择图片<input type="file" class="upload_pic" id="uploadtwo"/></span>
                    </div>
                </div>
            </div>
            <div class="form-group col-xl-12 padding-t-10">
                <div class="row">
                    <label class="col-md-2 control-label brokeragetime"></label>
                    <canvas id="cvstwo" width="150" height="150"></canvas>
                </div>
            </div>
            <div class="form-group col-xl-12 padding-t-10">
                <div class="row">
                    <label class="col-md-2 control-label brokeragetime">站点版权信息</label>
                    <div class="col-md-6">
                        <textarea style="resize: none; min-height:200px;width: 100%;border:1px solid #E4E4E4" cols="5" rows="5"></textarea>
                    </div>
                </div>
            </div>
            <br/>
            <div class="form-group col-xl-12 padding-t-20">
                <div class="row">
                    <div class="col-md-2"></div>
                    <div class="col-md-4">
                        <button type="submit" class="btn btn-fill  btn-e" onclick="addmessageg()">保存并且添加</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>


<script>
    (function (window) {
        var childSiteList = [], parentSiteList = [],pagepostdata=apidata.postdata;
        //取得管理员可管理站点列表即查询员工平台站点列表
        var siteslist = utils_admin.setajax('POST', apidata.postdata, apidata.base.staffPtSitesList);
        siteslist.data.forEach((a, index) => {
            parentSiteList.push(a);
            childSiteList.push(a.siteList);
            parentSiteList[index].text = parentSiteList[index].ptName
            parentSiteList[index].id = parentSiteList[index].ptId;
        });
        window.utils_admin.loadhtml($(".parentsitelist"), '/dropdown.html', {
            "header": "选择平台",
            "id": null,
            "body": parentSiteList,
            "width": 150,
            "name": "parentsitelist",
        });
        $(".parentsitelist").click(function (a) {
            var id='';
            if (a.target.nodeName.toLowerCase() == "li") {
                id = a.target.getAttribute("id")
            } else {
                id = $(".parentsitelist")[0].id
            }
            pagepostdata.payload.ptId=id;
        });
        window.utils_admin.loadhtml($(".endchild"), '/dropdown.html', {
            "header": "先选择平台",
            "id": null,
            "body": [
                {
                    "text":"主站",
                    "id":"0"
                },
                {
                    "text":"子站",
                    "id":"1"
                }
            ],
            "width": 150,
            "name": "endchild",
        });
        $(".endchild").click(function (a) {
            var id="0";
            if (a.target.nodeName.toLowerCase() == "li") {
                id = a.target.getAttribute("id")
            } else {
                id = $(".endchild")[0].id
            }
            pagepostdata.payload.Main=id;
        });

        //是否启用
        window.utils_admin.loadhtml($(".dropdowns1"), '/dropdown.html', {
            "header": "是",
            "id":"0",
            "body": [
                {
                    "text": "是",
                    "id":"0"
                },
                {
                    "text": "否",
                    "id":"1"
                }
            ],
            "width": 150,
            "name":"dropdowns1"
        });
        pagepostdata.payload.able="0";
        $(".dropdowns1").click(function (a) {
            var id="0";
            if (a.target.nodeName.toLowerCase() == "li") {
                id = a.target.getAttribute("id")
            } else {
                id = $(".dropdowns1")[0].id
            }
            pagepostdata.payload.able=id;
        });

        //上传图片
        var input1= window.document.getElementById("upload1");
        var canvas1 = window.document.getElementById("cvs1");
        window.utils_admin.setimg(input1, canvas1, function (setdata) {
            pagepostdata.payload.photo="1"
            pagepostdata.payload.siteLogo = setdata.data.fileId
        },pagepostdata);

        var inputwo = window.document.getElementById("uploadtwo");
        var canvastwo = window.document.getElementById("cvstwo");
        window.utils_admin.setimg(inputwo, canvastwo, function (setdata) {
            pagepostdata.payload.photo="1"
            pagepostdata.payload.pageHeadImg = setdata.data.fileId
        },pagepostdata);

        function addmessageg() {
            let inputdata = $("input[type=text]");
            if (inputdata[0].value == '') {
                alert("必填项")
            } else {
                pagepostdata.payload.siteName = inputdata[0].value;
                pagepostdata.payload.siteDomain = inputdata[1].value;
                pagepostdata.payload.siteCode = inputdata[2].value;
                pagepostdata.payload.pageSiteCopyright = $("textarea").val();
                if(pagepostdata.payload.photo==0){
                    alert("文件或者图片正在上传")
                }else {
                    utils_admin.setajax('POST', pagepostdata, apidata.base.ptsetSite);
                    //设置主站
                    if(pagepostdata.payload.Main=="0"){
                        utils_admin.setajax('POST', pagepostdata, apidata.base.setMainSite)
                    }
                    //是否启用
                    if(pagepostdata.payload.able=="0"){
                        utils_admin.setajax('POST', pagepostdata, apidata.base.enableSite)
                    }else {
                        utils_admin.setajax('POST', pagepostdata, apidata.base.disableSite)
                    }
                    window.location.href='/admin/views/index.html#/muchgerent'
                }
            }
        }
        window.addmessageg=addmessageg;
    })(window)
</script>
