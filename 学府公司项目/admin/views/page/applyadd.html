<div class="col-md-12">
    <div class="horizontal-form">
        <div class="card-body">
            <div class="form-group col-xl-12 padding-t-10">
                <div class="row">
                    <label class="col-md-2 control-label brokeragetime">班级名称</label>
                    <div class="col-md-4">
                        <input type="text" placeholder="填写班级名称" class="form-control">
                    </div>
                </div>
            </div>
            <div class="form-group col-xl-12 padding-t-10">
                <div class="row">
                    <label class="col-md-2 control-label brokeragetime">班级介绍</label>
                    <div class="col-md-10">
                        <textarea style="resize: none; min-height:200px;width: 100%;border:1px solid #E4E4E4" cols="5"
                                  rows="5"></textarea>
                    </div>
                </div>
            </div>

            <div class="form-group col-xl-12 padding-t-10">
                <div class="row">
                    <label class="col-md-2 control-label brokeragetime">班级图片</label>
                    <div class="col-md-10">
                        <div class="con4">
                            <div id="cvstwo" class="imgcanvas"></div>
                            <span class="btn upload">上传<input type="file" class="upload_pic" id="uploadtwo"/></span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="form-group col-md-12 padding-t-10">
                <div class="row">
                    <label class="col-md-2 control-label brokeragetime">培训老师</label>
                    <div class="col-md-4">
                        <input type="text" placeholder="" class="form-control">
                    </div>
                </div>
            </div>
            <div class="form-group col-md-12 padding-t-10">
                <div class="row">
                    <label class="col-md-2 control-label brokeragetime">培训地点</label>
                    <div class="col-md-4">
                        <input type="text" placeholder="" class="form-control">
                    </div>
                </div>
            </div>

            <div class="form-group col-md-12 padding-t-10">
                <div class="row">
                    <label class="col-md-2 control-label brokeragetime">指导老师</label>
                    <div class="col-md-4">
                        <input type="text" placeholder="" class="form-control">
                    </div>
                </div>
            </div>
            <div class="form-group col-xl-12 padding-t-10">
                <div class="row">
                    <label class="col-md-2 control-label brokeragetime">培训方式</label>
                    <div class="col-md-4">
                        <div class="option"></div>
                    </div>
                </div>
            </div>
            <div class="form-group col-xl-12 padding-t-10">
                <div class="row">
                    <label class="col-md-2 control-label brokeragetime">培训时间</label>
                    <div class="col-md-7">
                        <ul class=" list-unstyled list-inline antime1">
                            <li class="" style="width: 35%">
                                <input type="text" id="datetimepicker" class="form-control datepicker"
                                       placeholder="选择日期"/>
                            </li>

                            <li class="fdong" style="width:5%;">到</li>
                            <li class="" style="width: 35%">
                                <input type="text" class="form-control datepicker" placeholder="选择日期"/>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
            <div class="form-group col-xl-12 padding-t-10">
                <div class="row">
                    <label class="col-md-2 control-label brokeragetime">班级地区</label>
                    <div class="col-md-4">
                        <div class="choose"></div>
                    </div>
                </div>
            </div>
            <div class="form-group col-md-12 padding-t-10">
                <div class="row">
                    <label class="col-md-2 control-label brokeragetime">报名费用</label>
                    <div class="col-md-3">
                        <input type="text" placeholder="" class="form-control">
                    </div>
                    <div class="rylist">
                        免费请填写0
                    </div>
                </div>
            </div>
            <div class="form-group col-xl-12 padding-t-10">
                <div class="row">
                    <label class="col-md-2 control-label brokeragetime">班级归属</label>
                    <div class="col-md-10 row rylist">
                        <div class="col-md-4">
                            <div class="parentsitelist "></div>
                        </div>
                        <div class="col-md-4">
                            <div class="endchild"></div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="form-group col-xl-12 padding-t-10">
                <div class="row">
                    <label class="col-md-2 control-label brokeragetime">班级分类</label>
                    <div class="col-md-10 row rylist">
                        <div class="sequence col-md-4"></div>
                        <div class="newscategorychild col-md-4"></div>
                    </div>
                </div>
            </div>
            <br/>
            <br/>
            <div class="form-group col-xl-12 col-md-12 padding-t-20">
                <div class="row">
                    <label class="col-md-2 control-label brokeragetime"></label>
                    <div class="col-md-2">
                        <button type="submit" class="btn btn-fill  btn-e" onclick="savemessageg()">保存</button>
                    </div>
                    <div class="col-md-2">
                        <button type="submit" class="btn btn-fill  btn-e" onclick=" addmessageg()">保存并发布</button>
                    </div>
                    <div class="col-md-2">
                        <a href="/admin/views/index.html#/applygrade" class="btn btn-fill  btn-e">返回</a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>


<script>
    (function (window, $) {
        var pagepostdata = utils_admin.clone(apidata.postdata);
        var newdata = '';
        var inputwo = window.document.getElementById("uploadtwo");
        var canvastwo = window.document.getElementById("cvstwo");
        if (pagepostdata.payload.czId) {
            let inputdata = $("input[type=text]");
            newdata = utils_admin.setajax('POST', pagepostdata, apidata.schoolclass.queryById).data;
            inputdata[0].value = newdata.czName;
            $("textarea").val(newdata.czSummary);
            inputdata[1].value = newdata.czMasterTrainer;
            inputdata[2].value = newdata.czAdress;
            inputdata[3].value = newdata.czSecondaryTrainer;
            inputdata[4].value = newdata.czStartDate;
            inputdata[5].value = newdata.czEndDate;
            inputdata[6].value = newdata.czTrainingFee;
            pagepostdata.payload.czAdress = newdata.czAdress;
            pagepostdata.payload.areaId = newdata.areaId;
            pagepostdata.payload.czTrainingType = newdata.czTrainingType
            pagepostdata.payload.ptId = newdata.ptId;
            pagepostdata.payload.siteId = newdata.siteId
            utils_admin.returnimg(canvastwo, newdata.photo);

        }
        window.utils_admin.calendar($('.datepicker'));

        window.utils_admin.loadhtml($(".option"), '/dropdown.html', {
            "header": newdata ? newdata.czTrainingType == '1' ? "线下" : "线上" : "选择培训方式",
            "id": newdata ? newdata.czTrainingType : null,
            "body": [
                {
                    "id": "1",
                    "text": "线下"
                }, {
                    "id": "2",
                    "text": "线上"
                }
            ],
            "width": 150,
            "name": "option",
        });
        $(".option").click(function (a) {
            pagepostdata.payload.czTrainingType = utils_admin.downid(a, "option");
        });
        window.utils_admin.loadhtml($(".choose"), '/dropdown.html', {
            "header": newdata ? newdata.areaId : "选择地区",
            "id": newdata ? newdata.czAdres : null,
            "body": [
                {
                    "id": "合肥市",
                    "text": "合肥"
                },
                {
                    "id": "宿州市",
                    "text": "宿州"
                },
                {
                    "id": "宿州市",
                    "text": "宿州"
                },
                {
                    "id": "淮北市",
                    "text": "淮北"
                },
                {
                    "id": "亳州市",
                    "text": "亳州"
                },
                {
                    "id": "阜阳市",
                    "text": "阜阳"
                },
                {
                    "id": "蚌埠市",
                    "text": "蚌埠"
                },
                {
                    "id": "淮南市",
                    "text": "淮南"
                },
                {
                    "id": "滁州市",
                    "text": "滁州"
                },
                {
                    "id": "六安市",
                    "text": "六安"
                },
                {
                    "id": "马鞍山市",
                    "text": "马鞍山"
                },
                {
                    "id": "安庆市",
                    "text": "安庆"
                },
                {
                    "id": "芜湖市",
                    "text": "芜湖"
                },
                {
                    "id": "铜陵市",
                    "text": "铜陵"
                },
                {
                    "id": "宣城市",
                    "text": "宣城"
                },
                {
                    "id": "池州市",
                    "text": "池州"
                },
                {
                    "id": "黄山市",
                    "text": "黄山"
                }
            ],
            "width": 150,
            "name": "choose",
        });


        $(".choose").click(function (a) {
            pagepostdata.payload.areaId = utils_admin.downid(a, "choose");
        });

        //站点,平台初始化
        window.utils_admin.loadhtml($(".parentsitelist"), '/dropdown.html', {
            "header": newdata ? newdata.ptName : "所有平台",
            "id": newdata ? newdata.ptId : null,
            "body": window.parentSiteList,
            "width": 120,
            "name": "parentsitelist",
        });
        window.utils_admin.loadhtml($(".endchild"), '/dropdown.html', {
            "header": newdata ? newdata.siteName : "先选择平台",
            "id": newdata ? newdata.siteId : null,
            "body": null,
            "width": 120,
            "name": "endchild",
        });
        //换站点
        $(".parentsitelist").click(function (a) {
            let id = '', endchild = [];
            if (a.target.nodeName.toLowerCase() == "li") {
                id = a.target.getAttribute("id")
            } else {
                id = window.parentSiteList[0].id
            }
            window.childSiteList.forEach((a) => {
                a.forEach((e, index) => {
                    if (e.ptId == id) {
                        endchild.push(e)
                        endchild[index].text = endchild[index].siteName;
                        endchild[index].id = endchild[index].siteId;
                    }
                })
            });
            pagepostdata.payload.siteId = endchild[0].id
            window.utils_admin.loadhtml($(".endchild"), '/dropdown.html', {
                "header": endchild[0].text,
                "id": endchild[0].id,
                "body": endchild,
                "width": 120,
                "name": "endchild",
            });
        });
        $(".endchild").click(function (a) {
            pagepostdata.payload.siteId = utils_admin.downid(a, "endchild");
        });

        //栏目分类
        var newscategoryone = utils_admin.setajax('POST', pagepostdata, apidata.schoolclass.clzCategory);
        window.utils_admin.loadhtml($(".sequence"), '/dropdown.html', {
            "header": "选择分类",
            "id": null,
            "body": utils_admin.loop(newscategoryone.data, "catId", "catName"),
            "width": 135,
            "name": "sequence",
        });
        window.utils_admin.loadhtml($(".newscategorychild"), '/dropdown.html', {
            "header": "先选择分类一",
            "id": null,
            "body": null,
            "width": 135,
            "name": "newscategorychild",
        });
        $(".sequence").click(function (a) {
            let id = utils_admin.downid(a, "sequence");
            pagepostdata.payload.csCatstr = id;
            if (id) {
                let newscatechaild = utils_admin.setajax('POST', pagepostdata, apidata.resource.cqueryManagePage);
                window.utils_admin.loadhtml($(".newscategorychild"), '/dropdown.html', {
                    "header": "先选择分类一",
                    "id": null,
                    "body": newscatechaild.data ? utils_admin.loop(newscatechaild.data, "catId", "catName") : "",
                    "width": 135,
                    "name": "newscategorychild",
                });
            }
        });
        $(".newscategorychild").click(function (a) {
            if (pagepostdata.payload.csCatstr) {
                pagepostdata.payload.csCatstr = pagepostdata.payload.csCatstr + utils_admin.downid(a, "newscategorychild");
            }
            pagepostdata.payload.csCatstr = utils_admin.downid(a, "newscategorychild");
        });


        //上传图片
        window.utils_admin.setimg(inputwo, canvastwo, function (setdata) {
            pagepostdata.payload.photo = "1";
            pagepostdata.payload.czPhoto = setdata.data.fileId;
            pagepostdata.payload.actImgs = setdata.data.fileId;
            utils_admin.returnimg(canvastwo, setdata.data.fileUrl);

        });

        //保存
        function savemessageg() {
            let inputdata = $("input[type=text]");
            if (inputdata[0].value == '') {
                alert("必填项")
            } else {
                pagepostdata.payload.czName = inputdata[0].value;
                pagepostdata.payload.czSummary = $("textarea").val();
                pagepostdata.payload.czMasterTrainer = inputdata[1].value;
                pagepostdata.payload.czAdress = inputdata[2].value;
                pagepostdata.payload.czSecondaryTrainer = inputdata[3].value;
                pagepostdata.payload.czStartDate = inputdata[4].value;
                pagepostdata.payload.czEndDate = inputdata[5].value;
                pagepostdata.payload.czTrainingFee = inputdata[6].value;
                if (pagepostdata.payload.photo == "0") {
                    alert("图片正在上传")
                } else {
                    let setdata = utils_admin.setajax('POST', pagepostdata, apidata.schoolclass.clzClazz);
                    pagepostdata.payload.ids = setdata.data.id;
                    alert("成功")
                }
            }
        }

        //保存并提交
        function addmessageg() {
            savemessageg();
            pagepostdata.payload.czPubStatus = "1";
            let getdata = utils_admin.setajax('POST', pagepostdata, apidata.schoolclass.clzClazzpublish);
            if (getdata.success == "1") {
                window.location.href = "/admin/views/index.html#/applygrade"
            }
        }

        window.addmessageg = addmessageg;
        window.savemessageg = savemessageg;
    })(window, window.$)

</script>
