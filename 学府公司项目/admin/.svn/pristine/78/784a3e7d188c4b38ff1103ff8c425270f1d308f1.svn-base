<div class="col-md-12">
    <div class="horizontal-form">
        <div class="card-body">
            <div class="form-group col-xl-12 padding-t-10">
                <div class="row">
                    <label class="col-md-2 control-label brokeragetime">分类名称</label>
                    <div class="col-md-4">
                        <input type="text" placeholder="填写分类名称" class="form-control catName">
                    </div>
                    <div class="col-md-1 text-danger">*</div>
                </div>
            </div>
            <div class="form-group col-xl-12 padding-t-10">
                <div class="row">
                    <label class="col-md-2 control-label brokeragetime">活动归属</label>
                    <div class="col-md-10 row rylist">
                        <div class="col-md-4">
                            <div class="parentsitelist"></div>
                        </div>
                        <div class="col-md-4">
                            <div class="endchild"></div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="form-group col-xl-12 padding-t-20 isView">
                <div class="row">
                    <div class="col-md-2"></div>
                    <div class="col-md-4">
                        <button type="submit" class="btn btn-fill  btn-e" onclick="savemessageg(this)">保存</button>
                        <button type="submit" class="btn btn-fill  btn-e" onclick="goback(this)">返回</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>


<script>
    (function (window, $) {
        var pagepostdata = apidata.postdata;
        let setdata={};
        if(pagepostdata.payload.rstId){
            setdata = utils_admin.setajax('POST', pagepostdata, apidata.activity.actResultQueryById).data;
            apidata.postdata.payload.rstId="";
            console.log(setdata);
            let inputdata = $("input[type=text]");
            inputdata[0].value=setdata.rstTitle;
            $("textarea").val(setdata.rstContent);
            $(".isView").css("display","none");
        }
        //站点,平台初始化
        window.utils_admin.loadhtml($(".parentsitelist"), '/dropdown.html', {
            "header": setdata.siteId? setdata.ptName:"请选择平台",
            "id": null,
            "body": window.parentSiteList,
            "width": 120,
            "name": "parentsitelist",
        });
        window.utils_admin.loadhtml($(".endchild"), '/dropdown.html', {
            "header":  setdata.siteId? setdata.siteName:"请选择站点",
            "id": null,
            "body": null,
            "width": 120,
            "name": "endchild",
        });
        //换站点
        // function parentsitelist(a) {
        $(".parentsitelist").click(function (a) {
            let id = '', endchild = [];
            if (a.target.nodeName.toLowerCase() == "li") {
                id = a.target.getAttribute("id")
            } else {
                id = window.parentSiteList[0].id
            }
            window.childSiteList.forEach((a) => {
                a.forEach((e, index) => {
                    if (e.ptId == id) {
                        endchild.push(e)
                        endchild[index].text = endchild[index].siteName;
                        endchild[index].id = endchild[index].siteId;
                    }
                })
            });
            pagepostdata.payload.siteId = endchild[0].id;

            window.utils_admin.loadhtml($(".endchild"), '/dropdown.html', {
                "header": endchild[0].text,
                "id": endchild[0].id,
                "body": endchild,
                "width": 120,
                "name": "endchild",
            });
        });
        // }
        $(".endchild").click(function (a) {
            var id='';
            if (a.target.nodeName.toLowerCase() == "li") {
                id = a.target.getAttribute("id")
            } else {
                id = $(".endchild input")[0].id
            }
            pagepostdata.payload.siteId = id;
        });

        //保存数据
        function savemessageg(e){
            let inputdata = $(".catName").val();
            if(inputdata==""){
                alert("请填写分类名称");
                return false;
            }
            pagepostdata.payload.catName=inputdata;
            console.log(pagepostdata.payload);
            var result= utils_admin.setajax('POST', pagepostdata, apidata.studygroup.studygroupCateSave);
            var id =result.data.id;
            pagepostdata.payload.catName="";
            window.location.href = "/admin/views/index.html#/classifyacquirement"
        }
        function goback(e){
            window.location.href = "/admin/views/index.html#/classifyacquirement";
        }
        window.savemessageg = savemessageg;
        window.goback=goback;
    })(window, window.$)
</script>