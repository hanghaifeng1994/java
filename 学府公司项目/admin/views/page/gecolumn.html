<div class="card-body">
    <div class="tab-content">
        <div class="col-md-12 row" style="padding-top: 10px">
            <div class="col-md-6 col-xs-12 row">
                <div class="col-md-4 col-xs-12">
                    <div class="parentsitelist"></div>
                </div>
                <div class="col-md-4 col-xs-12" style="margin-left: 50px">
                    <div class="endchild"></div>
                </div>
            </div>
            <div class="col-md-6 col-xs-12 row ">
                <div class="col-md-12 col-xs-12">
                    <button class="btn btn-e btn-wd resultAdd"  onclick="resultAdd(this)">成果上传</button>
                    <button class="btn btn-e btn-wd" onclick="delBatch(this)">批量删除</button>
                </div>
            </div>
        </div>
        <div class="container-fluid padding-t-20">
            <div class="row">
                <div class="col-md-12 ">
                    <table class="table table-bordered table-hover" id="tablecz">
                        <thead>
                        <th><input class="fuxk" name="allcheck" type="checkbox" value="" id="allcheck"
                                   onclick="selectall()"/></th>
                            <th class="text-center cuti">活动成果</th>
                            <th class="text-center cuti">上传人</th>
                            <th class="text-center cuti">上传时间</th>
                            <th class="text-center cuti">状态</th>
                            <th class="text-center cuti">操作</th>
                        </tr>
                        </thead>
                        <tbody id="resultgecolumn"></tbody>
                    </table>
                    <div class="fenye">
                        <div class="pagination pagination0"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script type="text/html" id="resultgecolumn_t">
    {{each data}}
    <tr class="{{$value.rstId}}">
        <td><input class="fuxk" name="choose" type="checkbox" value="{{$value.rstId}}"/>
        </td>
        <td class="text-center"> {{$value.rstTitle}}</td>
        <td class="text-center">
            {{$value.rstUserName}}
        </td>
        <td class="text-center">
            {{$value.createDate}}
        </td>
        <td class="text-center" data-status="{{$value.rstStatus}}" >
            {{ if $value.rstStatus==1}}审核中
            {{else if $value.rstStatus==2}}审核通过
            {{else if $value.rstStatus==3}}审核失败
            {{else $value.rstStatus==0}}未提交
            {{/if}}
        </td>

        <!--改第一个tab表格抬头对应数据结束-->
        <!--单行操作区-根据具体页面选择对应按钮修，不需要的注释-->
        <td class="text-center caozuo">
            <a href="javascript:void(0);"  data-status="{{$value.rstStatus}}" data-id="{{$value.rstId}}"
               onclick="audit(this)">
                {{if $value.rstStatus=="1"}}审核
                {{else if $value.rstStatus=="1" || $value.rstStatus !="" &&  $value.rstStatus!="2" && $value.rstStatus !="3"}}提交审核
                {{/if}}</a>
            <a href="javascript:void(0);" data-id="{{$value.rstId}}"
               onclick="view(this)">
                预览</a>
            <a href="javascript:void(0);" data-id="{{$value.rstId}}"
               onclick="deleteById(this)">
               删除
            </a>
        </td>
    </tr>
    {{/each}}
</script>
<script>
    (function (window) {
        if(apidata.postdata.payload.actId){
            $(".resultAdd").attr("data-id",apidata.postdata.payload.actId)
        }
        var pagepostdata=utils_admin.clone(apidata.postdata);
        var pagedata = utils_admin.setajax('POST', pagepostdata, apidata.activity.actResultPage);
        utils_admin.queryPage("resultgecolumn", "resultgecolumn_t", pagedata);
        new pagination({
            pagination: $('.pagination0'),//分页挂载的样式名称
            maxPage: 5, //最大页码数,支持奇数，左右对称
            startPage: 1,    //默认第一页
            currentPage: 1,          //当前页码
            totalPageCount: (pagedata.totalCount / pagedata.pageSize) - (pagedata.totalCount / pagedata.pageSize) % 1 + 1,  //总页数
            callback: function (pageNum) {
                apidata.postdata.payload.page = "" + pageNum + "";
                //修改查询接口-apidata.news.queryPage
                utils_admin.queryPage("resultgecolumn", "resultgecolumn_t", utils_admin.setajax('POST', apidata.postdata, apidata.activity.actResultPage));
            }
        });
        //删除成果
        function deleteById(e){
            var id= $(e).attr("data-id");
            pagepostdata.payload.rstId=id;
            $("#toolTipbox").toggle("hidden");
        }
        //批量删除
        function delBatch(e){
            var ids = utils_admin.choosevalue("tablecz");
            pagepostdata.payload.rstId=ids;
            $("#toolTipbox").toggle("hidden");
        }

        //弹窗的确定和取消操作
        $(".btnSumbit").click(function(){
           var index= $(this).attr("data-id");
           //1确定 调用接口 2是取消关闭弹窗
           if(index=="1"){
               utils_admin.setajax('POST', pagepostdata, apidata.activity.actResultDelete);
               utils_admin.queryPage("resultgecolumn", "resultgecolumn_t", utils_admin.setajax('POST', apidata.postdata, apidata.activity.actResultPage));
           }
           $("#toolTipbox").toggle("hidden");
        });
        //成果上传
        function resultAdd(e){
            utils_admin.redact("activityRstAdd", "actId", e)
        }

        //成果预览
        function view(e){
            utils_admin.redact("activityRstAdd", "rstId", e)
        }
        //审核
        function audit(e){
            var id= e.dataset.id;
            var status= $(e).attr("data-status");
            pagepostdata.payload.rstId=id;
            //如果审核状态不为1则是提交审核 否则是审核
            if(status=="1"){
                //跳转到审核页面
                utils_admin.redact("activityRstaudit", "rstId", e);
            } else{
                //调用审核接口
                pagepostdata.payload.rstStatus="1";
                utils_admin.setajax('POST', pagepostdata, apidata.activity.actResultSumbitAudit);
                pagepostdata.payload.rstStatus="";
                utils_admin.queryPage("resultgecolumn", "resultgecolumn_t", utils_admin.setajax('POST', apidata.postdata, apidata.activity.actResultPage));
            }
        }
        window.deleteById=deleteById;
        window.view=view;
        window.audit=audit;
        window.delBatch=delBatch;
        window.resultAdd=resultAdd;
    })(window)

</script>