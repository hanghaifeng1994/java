<div class="col-md-12">
    <div class="col-md-12 row" style="padding-top: 10px">
        <div class="col-md-6 col-xs-12 row">
            <div class="col-md-4 col-xs-12">
                <div class="parentsitelist"></div>
            </div>
            <div class="col-md-4 col-xs-12" style="margin-left: 50px">
                <div class="endchild"></div>
            </div>
        </div>
        <div class="col-md-6 col-xs-12 row ">
            <div class="col-md-12 col-xs-12">
                <button class="btn btn-e btn-wd" onclick="deleteclass()">新增分类</button>
                <a class="btn btn-e btn-wd" href="">编辑维度</a>
            </div>
        </div>
    </div>
    <div class="treetable"></div>
</div>
<div id="popups">

</div>
<script>
    (function (window) {
        var pagepostdata = apidata.postdata;

        var pagedata = utils_admin.setajax('POST', apidata.postdata, apidata.testing.queryList).data;
        pagedata.forEach((a, b) => {
            a.id = a.sectionId;
            a.one = a.name;
            a.two = a.parentId;
            if (a.childData) {
                a.child = false
            } else {
                a.child = true
            }
            a.menu = [
                {
                    "text": "编辑",
                    "method": "redactclass",
                },
                {
                    "text": "删除",
                    "method": "onedel",
                },
                {
                    "text": "新增",
                    "method": "add",
                }
            ]
        });
        console.log(pagedata);
        window.utils_admin.loadhtml($('.treetable'), '/treeTable.html', {
            "heardbutton": [{
                "type": "0",
                "text": "批量删除",
                "method": "",
            }, {
                "type": "1",
                "text": "添加友情链接",
                "href": "/#add",
            }
            ],
            "datath": [
                {
                    "text": "知识点名称"
                },
                {
                    "text": "类型"
                },
                {
                    "text": "操作"
                }
            ],
            "tabledata": pagedata,
        });


        //站点,平台初始化
        window.utils_admin.loadhtml($(".parentsitelist"), '/dropdown.html', {
            "header": "所有平台",
            "id": null,
            "body": window.parentSiteList,
            "width": 120,
            "name": "parentsitelist",
        });
        window.utils_admin.loadhtml($(".endchild"), '/dropdown.html', {
            "header": "先选择平台",
            "id": null,
            "body": null,
            "width": 120,
            "name": "endchild",
        });
        //换站点
        $(".parentsitelist").click(function (a) {
            let id = '', endchild = [];
            if (a.target.nodeName.toLowerCase() == "li") {
                id = a.target.getAttribute("id")
            } else {
                id = window.parentSiteList[0].id
            }
            window.childSiteList.forEach((a) => {
                a.forEach((e, index) => {
                    if (e.ptId == id) {
                        endchild.push(e)
                        endchild[index].text = endchild[index].siteName;
                        endchild[index].id = endchild[index].siteId;
                    }
                })
            });
            window.utils_admin.loadhtml($(".endchild"), '/dropdown.html', {
                "header": endchild[0].text,
                "id": endchild[0].id,
                "body": endchild,
                "width": 120,
                "name": "endchild",
            });
        });
        $(".endchild").click(function (a) {
            if (a.target.nodeName.toLowerCase() == "li") {
                id = a.target.getAttribute("id")
            } else {
                id = $(".endchild")[0].id
            }
            pagepostdata.payload.siteId = id;
        });


        function selectallbelow(e) {
            console.log(e)
        }

        function beforeExpand(treeTable, id) {
            if ($('.' + id, treeTable).length) {
                return;
            }
            apidata.postdata.payload.parentId = id;
            let postdata = utils_admin.setajax('POST', apidata.postdata, apidata.news.newsCategoryqueryPage).data;
            if (postdata) {
                let html = '';
                for (var i = 0; i < postdata.length; i++) {
                    postdata[i].childData ? postdata[i].childData = true : postdata[i].childData = false;
                    html += "<tr id=" + postdata[i].catId + " pId=" + postdata[i].parentId + " hasChild=" + postdata[i].childData + ">" +
                        "<td><input class='fuxk' name='choose' type='checkbox' value=" + id + "/></td>" +
                        "<td>" + postdata[i].catName + "</td>" +
                        "<td>" + postdata[i].catId + "</td>" +
                        "<td>" + postdata[i].catLevel + "</td>" +
                        "<td>" + postdata[i].catName + "</td>" +
                        "<td  class='text-center caozuo' style='color: #00bbff'>" +
                        "<a onclick='redactclass(this)' data-id=" + postdata[i].catId + ">编辑  </a>" +
                        "<a onclick='onedel(this)' data-id=" + postdata[i].catId + ">删除</a>" +
                        "</td></tr>";
                }
                treeTable.addChilds(html);
            }
        }
        window.selectallbelow=selectallbelow;
        window.beforeExpand=beforeExpand;
    })(window)
</script>