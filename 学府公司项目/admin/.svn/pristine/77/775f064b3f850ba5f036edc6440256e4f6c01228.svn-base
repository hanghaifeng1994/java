<div class="col-md-12">
    <div class="horizontal-form">
        <div class="card-body">
            <div class="form-group col-xl-12 padding-t-10">
                <div class="row">
                    <label class="col-md-2 control-label brokeragetime">活动主题</label>
                    <div class="col-md-4">
                        <input type="text" placeholder="" class="form-control">
                    </div>
                    <div class="col-md-1 text-danger">*</div>
                </div>
            </div>
            <div class="form-group col-xl-12 padding-t-10">
                <div class="row">
                    <label class="col-md-2 control-label brokeragetime">活动介绍</label>
                    <div class="col-md-10">
                        <textarea style="resize: none; min-height:200px;width: 100%;border:1px solid #E4E4E4" cols="5"
                                  rows="5"></textarea>
                    </div>
                </div>
            </div>
            <div class="form-group col-xl-12 padding-t-10">
                <div class="row">
                    <label class="col-md-2 control-label brokeragetime">活动图片</label>
                    <div class="col-md-10">
                        <div class="con4">
                            <div id="cvstwo" class="imgcanvas"></div>
                            <span class="btn upload">上传<input type="file" class="upload_pic" id="uploadtwo"/></span>
                        </div>
                    </div>
                </div>
            </div>
            <div class="form-group col-xl-12 padding-t-10">
                <div class="row">
                    <label class="col-md-2 control-label brokeragetime">活动类型</label>
                    <div class="col-md-10 row rylist">
                        <div class="activity col-md-4 "></div>
                    </div>
                </div>
            </div>
            <div class="form-group col-xl-12 padding-t-10">
                <div class="row">
                    <label class="col-md-2 control-label brokeragetime">活动地区</label>
                    <div class="col-md-4">
                        <input type="text" placeholder="" class="form-control">
                    </div>
                </div>
            </div>
            <div class="form-group col-xl-12 padding-t-10">
                <div class="row">
                    <label class="col-md-2 control-label brokeragetime">活动时间</label>
                    <div class="col-md-7">
                        <ul class=" list-unstyled list-inline antime1">
                            <li class="" style="width: 35%">
                                <input type="text" id="datetimepicker" class="form-control datepicker"
                                       placeholder="选择日期"/>
                            </li>

                            <li class="fdong" style="width:5%;">到</li>
                            <li class="" style="width: 35%">
                                <input type="text" class="form-control datepicker" placeholder="选择日期"/>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
            <div class="form-group col-xl-12 padding-t-10">
                <div class="row">
                    <label class="col-md-2 control-label brokeragetime">活动归属</label>
                    <div class="col-md-10 row rylist">
                        <div class="col-md-4">
                            <div class="parentsitelist"></div>
                        </div>
                        <div class="col-md-4">
                            <div class="endchild"></div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="form-group col-xl-12 padding-t-10">
                <div class="row">
                    <label class="col-md-2 control-label brokeragetime">活动分类</label>
                    <div class="col-md-10 row rylist">
                        <div class="dropdowns col-md-4 "></div>
                    </div>
                </div>
            </div>

            <br/>
            <br/>
            <div class="form-group col-xl-12 padding-t-20">
                <div class="row">
                    <div class="col-md-2"></div>
                    <div class="col-md-3">
                        <button type="submit" class="btn btn-fill  btn-e" onclick="addAndSumbit()">保存并提交</button>
                    </div>
                    <div class="col-md-4">
                        <button type="submit" class="btn btn-fill  btn-e" onclick="addmessageg()">保存</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>


<script>
    (function (window,$) {
        let pagepostdata=utils_admin.clone(apidata.postdata);
        let setdata={};
        var inputwo = window.document.getElementById("uploadtwo");
        var canvastwo = window.document.getElementById("cvstwo");
        if(pagepostdata.payload.actId){
             setdata = utils_admin.setajax('POST', pagepostdata, apidata.activity.actactivity).data;
            apidata.postdata.payload.actId="";
            utils_admin.returnimg(canvastwo,setdataactImgs)
            console.log(setdata);
            let inputdata = $("input[type=text]");
            inputdata[0].value=setdata.actTitle;
            $("textarea").val(setdata.actInfo);
            inputdata[1].value=setdata.actAreaId
            inputdata[2].value=setdata.actStartDate
            inputdata[3].value=setdata.actEndDate;

        }
        window.utils_admin.calendar($('.datepicker'));
        window.utils_admin.loadhtml($(".activity"), '/dropdown.html', {
            "header":setdata.actType? setdata.actType:"先选择活动类型",
            "id": null,
            "body":[
                {
                    "id":"1",
                    "text":"宣传活动"
                },{
                    "id":"2",
                    "text":"评比类活动"
                }
            ],
            "width": 150,
            "name": "activity",
        });

        $(".activity").click(function (a) {
            if (a.target.nodeName.toLowerCase() == "li") {
                id = a.target.getAttribute("id")
            } else {
                id = $(".activity")[0].id
            }
            pagepostdata.payload.actType = id;
        });

        //站点,平台初始化
        window.utils_admin.loadhtml($(".parentsitelist"), '/dropdown.html', {
            "header": setdata.siteId? setdata.ptName:"请选择平台",
            "id": null,
            "body": window.parentSiteList,
            "width": 120,
            "name": "parentsitelist",
        });
        window.utils_admin.loadhtml($(".endchild"), '/dropdown.html', {
            "header":  setdata.siteId? setdata.siteName:"请选择站点",
            "id": null,
            "body": null,
            "width": 120,
            "name": "endchild",
        });
        //换站点
        // function parentsitelist(a) {
            $(".parentsitelist").click(function (a) {
            let id = '', endchild = [];
            if (a.target.nodeName.toLowerCase() == "li") {
                id = a.target.getAttribute("id")
            } else {
                id = window.parentSiteList[0].id
            }
            window.childSiteList.forEach((a) => {
                a.forEach((e, index) => {
                    if (e.ptId == id) {
                        endchild.push(e)
                        endchild[index].text = endchild[index].siteName;
                        endchild[index].id = endchild[index].siteId;
                    }
                })
            });
            pagepostdata.payload.siteId = endchild[0].id;

            window.utils_admin.loadhtml($(".endchild"), '/dropdown.html', {
                "header": endchild[0].text,
                "id": endchild[0].id,
                "body": endchild,
                "width": 120,
                "name": "endchild",
            });
            });
        // }
        $(".endchild").click(function (a) {
            var id='';
            if (a.target.nodeName.toLowerCase() == "li") {
                id = a.target.getAttribute("id")
            } else {
                id = $(".endchild input")[0].id
            }
            pagepostdata.payload.siteId = id;
        });
        //栏目分类
        var actCate = utils_admin.setajax('POST', pagepostdata, apidata.activity.actCategory);
        var actCateArr = [];
        actCate.data.forEach((a) => {
            a.text = a.catName;
            a.id = a.catId;
            actCateArr.push(a)
        });
        window.utils_admin.loadhtml($(".dropdowns"), '/dropdown.html', {
            "header":setdata.catName? setdata.catName:"选择分类",
            "id": null,
            "body": actCateArr,
            "width": 135,
            "name": "actCateArr",
        });
        $(".dropdowns").click(function (a) {
            let id = '';
            if (a.target.nodeName.toLowerCase() == "li") {
                id = a.target.getAttribute("id")
            } else {
                id = $(".dropdowns")[0].id
            }
            pagepostdata.payload.catId = id;
        });


        //上传图片
        window.utils_admin.setimg(inputwo, canvastwo, function (setdata) {
            pagepostdata.payload.photo = setdata.data.fileId
            pagepostdata.payload.actImgs = setdata.data.fileId
            utils_admin.returnimg(canvastwo,setdata.data.fileUrl)
        },pagepostdata);

        //保存并提交
        function addAndSumbit() {
            let inputdata = $("input[type=text]");
            var cate= $("input[name=newscategoryonearr]").val();
            if (cate=="") {
                alert("请填写分类")
                return false;
            }else {
                pagepostdata.payload.actTitle = inputdata[0].value;
                pagepostdata.payload.actInfo = $("textarea").val();
                pagepostdata.payload.actAreaId = inputdata[1].value;
                pagepostdata.payload.actStartDate = inputdata[2].value;
                pagepostdata.payload.actEndDate = inputdata[3].value;
                let setdata = utils_admin.setajax('POST', pagepostdata, apidata.activity.actactivitySave);
                pagepostdata.payload.actId = setdata.data.id;
                pagepostdata.payload.actStatus="1";
                utils_admin.setajax('POST', pagepostdata, apidata.activity.sumbitAudit);
                pagepostdata.payload.actStatus="";
                alert("保存成功")
            }
        }
        //保存
        function addmessageg() {
            let inputdata = $("input[type=text]");
            var cate= $("input[name=newscategoryonearr]").val();
            if (cate=="") {
                alert("请填写分类")
                return false;
            }
                pagepostdata.payload.actTitle = inputdata[0].value;
                pagepostdata.payload.actInfo = $("textarea").val();
                pagepostdata.payload.actAreaId = inputdata[1].value;
                pagepostdata.payload.actStartDate = inputdata[2].value;
                pagepostdata.payload.actEndDate = inputdata[3].value;
            let getdata = utils_admin.setajax('POST',pagepostdata, apidata.activity.actactivitySave);
            if (getdata.success == "1") {
                alert("新增成功！");
                pagepostdata.payload.actId="";
                window.location.href = "/admin/views/index.html#/activitygecolumn"
            }
        }

        window.addmessageg=addmessageg;
        window.addAndSumbit=addAndSumbit;
    })(window,window.$)
</script>